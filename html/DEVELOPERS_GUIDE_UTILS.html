<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç –ú–æ–¥—É–ª–∏ Who-Is-Who –∏ Message Top - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .breadcrumb {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #ddd;
            font-size: 0.9em;
            color: #666;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .content {
            padding: 40px;
        }

        .content h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .content h2 {
            color: #764ba2;
            font-size: 1.6em;
            margin-top: 30px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            padding-left: 15px;
        }

        .content h3 {
            color: #667eea;
            font-size: 1.3em;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .content h4 {
            color: #764ba2;
            font-size: 1.1em;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        .content p {
            line-height: 1.8;
            margin: 15px 0;
            color: #444;
        }

        .content ul, .content ol {
            margin: 15px 0;
            margin-left: 30px;
            line-height: 1.8;
        }

        .content li {
            margin: 8px 0;
            color: #444;
        }

        .content code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
            font-size: 0.95em;
        }

        .content pre {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .content pre code {
            color: #333;
            padding: 0;
            background: none;
            font-size: 0.9em;
        }

        .content blockquote {
            border-left: 4px solid #667eea;
            padding-left: 20px;
            margin: 20px 0;
            color: #666;
            font-style: italic;
        }

        .content a {
            color: #667eea;
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .content a:hover {
            border-bottom-color: #667eea;
        }

        .content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .content table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
        }

        .content table td {
            border: 1px solid #ddd;
            padding: 12px;
        }

        .content table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .content hr {
            border: none;
            border-top: 2px solid #667eea;
            margin: 30px 0;
        }

        .content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 20px 0;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #ddd;
            justify-content: space-between;
        }

        .nav-button {
            display: inline-block;
            padding: 12px 24px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .nav-button:hover {
            background: #764ba2;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .nav-button.prev {
            margin-right: auto;
        }

        footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 0.9em;
        }

        footer a {
            color: #667eea;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .nav-buttons {
                flex-direction: column;
            }

            .nav-button.prev {
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç –ú–æ–¥—É–ª–∏ Who-Is-Who –∏ Message Top - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</h1>
            <p style="opacity: 0.9; font-size: 1.1em;">Chat Manager Bot - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</p>
        </header>

        <div class="breadcrumb">
            <a href="../html/index.html">üè† –ì–ª–∞–≤–Ω–∞—è</a> / 
            <a href="../html/index_site.html">üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</a> / 
            <span>üîç –ú–æ–¥—É–ª–∏ Who-Is-Who –∏ Message Top - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</span>
        </div>

        <div class="content">
            
<p><strong>–í–µ—Ä—Å–∏—è:</strong> 1.0<br />
<strong>–î–∞—Ç–∞:</strong> 20.12.2025<br />
<strong>–°—Ç–∞—Ç—É—Å:</strong> ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production<br />
<strong>–Ø–∑—ã–∫:</strong> Python 3.10+  </p>
<hr />
<h2>üìñ –û–±–∑–æ—Ä</h2>
<p>–î–≤–∞ —É—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã—Ö –º–æ–¥—É–ª—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –∏ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö:</p>
<ol>
<li><strong>Who-Is-Who</strong> (<code>modules/who_is_who.py</code>) - –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é</li>
<li><strong>Message Top</strong> (<code>modules/message_top.py</code>) - —Ç–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ —á–∞—Ç–µ</li>
</ol>
<hr />
<h2>üîç Who-Is-Who (–ö—Ç–æ —ç—Ç–æ?)</h2>
<h3>–û–±–∑–æ—Ä</h3>
<p>–ú–æ–¥—É–ª—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—é –∏–ª–∏ –Ω–∏–∫–Ω–µ–π–º—É. –ü–æ–∏—Å–∫ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è —Å—Ä–µ–¥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤ —á–∞—Ç–µ.</p>
<h3>–û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫</h3>
<pre class="codehilite"><code class="language-python">@dp.message_handler(Text(startswith=[&quot;–±–æ—Ç –∫—Ç–æ&quot;], ignore_case=True))
async def who_is_who(message: types.Message):
    &quot;&quot;&quot;
    –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
    –§–æ—Ä–º–∞—Ç: –±–æ—Ç –∫—Ç–æ {–æ–ø–∏—Å–∞–Ω–∏–µ}
    &quot;&quot;&quot;
</code></pre>

<p><strong>–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞:</strong>
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—à–µ—Ç <code>–±–æ—Ç –∫—Ç–æ {–æ–ø–∏—Å–∞–Ω–∏–µ}</code></p>
<p><strong>–õ–æ–≥–∏–∫–∞:</strong>
1. –ü–∞—Ä—Å–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
2. –ü–æ–ª—É—á–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —á–∞—Ç–∞
3. –ò—â–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤ <code>nik</code> (–Ω–∏–∫), <code>username</code> (—é–∑–µ—Ä–Ω–µ–π–º) –∏–ª–∏ <code>first_name</code> (–∏–º—è)
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –µ–≥–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π</p>
<h3>–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h3>
<h4>–ü—Ä–∏–º–µ—Ä 1: –ü–æ–∏—Å–∫ –ø–æ –Ω–∏–∫—É</h4>
<pre class="codehilite"><code class="language-python">def search_user_by_nic(chat_id: int, search_nic: str, db_path: str) -&gt; dict:
    &quot;&quot;&quot;–ò—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –Ω–∏–∫—É&quot;&quot;&quot;
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()

    table_name = str(-(chat_id))

    try:
        result = cursor.execute(
            f&quot;SELECT tg_id, nik, username, first_name FROM [{table_name}] WHERE nik LIKE ?&quot;,
            (f&quot;%{search_nic}%&quot;,)
        ).fetchone()

        if result:
            return {
                &quot;user_id&quot;: result[0],
                &quot;nik&quot;: result[1],
                &quot;username&quot;: result[2],
                &quot;first_name&quot;: result[3],
                &quot;found&quot;: True
            }
        else:
            return {&quot;found&quot;: False}
    finally:
        connection.close()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
result = search_user_by_nic(-1001234567890, &quot;Ivan&quot;, &quot;Base_bot.db&quot;)
if result[&quot;found&quot;]:
    print(f&quot;–ù–∞–π–¥–µ–Ω: {result['nik']} (@{result['username']})&quot;)
</code></pre>

<h4>–ü—Ä–∏–º–µ—Ä 2: –ü–æ–∏—Å–∫ –ø–æ —é–∑–µ—Ä–Ω–µ–π–º—É</h4>
<pre class="codehilite"><code class="language-python">def search_user_by_username(chat_id: int, username: str, db_path: str) -&gt; dict:
    &quot;&quot;&quot;–ò—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —é–∑–µ—Ä–Ω–µ–π–º—É&quot;&quot;&quot;
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()

    table_name = str(-(chat_id))

    # –£–±–∏—Ä–∞–µ–º @ –µ—Å–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
    if username.startswith(&quot;@&quot;):
        username = username[1:]

    try:
        result = cursor.execute(
            f&quot;SELECT tg_id, nik, username, first_name FROM [{table_name}] WHERE username = ?&quot;,
            (username,)
        ).fetchone()

        if result:
            return {
                &quot;user_id&quot;: result[0],
                &quot;nik&quot;: result[1],
                &quot;username&quot;: result[2],
                &quot;first_name&quot;: result[3],
                &quot;found&quot;: True
            }
        else:
            return {&quot;found&quot;: False}
    finally:
        connection.close()
</code></pre>

<h4>–ü—Ä–∏–º–µ—Ä 3: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫</h4>
<pre class="codehilite"><code class="language-python">def advanced_search(chat_id: int, keywords: list[str], db_path: str) -&gt; list[dict]:
    &quot;&quot;&quot;–ü–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º&quot;&quot;&quot;
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()

    table_name = str(-(chat_id))
    results = []

    try:
        for keyword in keywords:
            matches = cursor.execute(
                f&quot;SELECT tg_id, nik, username FROM [{table_name}] &quot;
                &quot;WHERE nik LIKE ? OR username LIKE ? OR first_name LIKE ?&quot;,
                (f&quot;%{keyword}%&quot;, f&quot;%{keyword}%&quot;, f&quot;%{keyword}%&quot;)
            ).fetchall()

            for user_id, nik, username in matches:
                results.append({
                    &quot;user_id&quot;: user_id,
                    &quot;nik&quot;: nik,
                    &quot;username&quot;: username
                })

        return results
    finally:
        connection.close()
</code></pre>

<hr />
<h2>üìä Message Top (–¢–æ–ø —Å–æ–æ–±—â–µ–Ω–∏–π)</h2>
<h3>–û–±–∑–æ—Ä</h3>
<p>–ú–æ–¥—É–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.</p>
<h3>–û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏</h3>
<pre class="codehilite"><code class="language-python">@dp.message_handler(Text(startswith=[&quot;—Ç–æ–ø –≤—Å—è&quot;, &quot;!—Ç–æ–ø —Å–æ–æ–±—â–µ–Ω–∏–π&quot;], ignore_case=True))
async def show_messages_top_all_time(message: types.Message):
    &quot;&quot;&quot;
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è
    –§–æ—Ä–º–∞—Ç: !—Ç–æ–ø —Å–æ–æ–±—â–µ–Ω–∏–π [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ]
    &quot;&quot;&quot;
</code></pre>

<p><strong>–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</strong></p>
<pre class="codehilite"><code>!—Ç–æ–ø —Å–æ–æ–±—â–µ–Ω–∏–π          # –¢–æ–ø 10 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
!—Ç–æ–ø —Å–æ–æ–±—â–µ–Ω–∏–π 20       # –¢–æ–ø 20
—Ç–æ–ø –≤—Å—è                 # –¢–æ–ø 10
—Ç–æ–ø –≤—Å—è 50              # –¢–æ–ø 50
</code></pre>

<h3>–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h3>
<h4>–ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ø —Å–æ–æ–±—â–µ–Ω–∏–π</h4>
<pre class="codehilite"><code class="language-python">def get_messages_top(chat_id: int, limit: int = 10, db_path: str = &quot;Base_bot.db&quot;) -&gt; list[tuple]:
    &quot;&quot;&quot;–ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–æ–æ–±—â–µ–Ω–∏–π&quot;&quot;&quot;
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()

    table_name = str(-(chat_id))

    try:
        # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∫–æ–ª–æ–Ω–∫—É —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π
        columns_info = cursor.execute(f&quot;PRAGMA table_info([{table_name}])&quot;).fetchall()
        column_names = [col[1] for col in columns_info]

        # –ò—â–µ–º –∫–æ–ª–æ–Ω–∫—É –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
        message_column = None
        for candidate in (&quot;mess_count&quot;, &quot;message_count&quot;, &quot;messages_count&quot;, &quot;msg_count&quot;, &quot;messages&quot;):
            if candidate in column_names:
                message_column = candidate
                break

        if not message_column:
            return []

        # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–ø
        top = cursor.execute(
            f&quot;SELECT nik, {message_column} FROM [{table_name}] ORDER BY {message_column} DESC LIMIT ?&quot;,
            (limit,)
        ).fetchall()

        return top
    finally:
        connection.close()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
top = get_messages_top(-1001234567890, limit=10)
for idx, (nik, msg_count) in enumerate(top, 1):
    print(f&quot;{idx}. {nik}: {msg_count} —Å–æ–æ–±—â–µ–Ω–∏–π&quot;)
</code></pre>

<h4>–ü—Ä–∏–º–µ—Ä 2: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–ø</h4>
<pre class="codehilite"><code class="language-python">def format_messages_top(chat_id: int, limit: int = 10, db_path: str = &quot;Base_bot.db&quot;) -&gt; str:
    &quot;&quot;&quot;–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ç–æ–ø –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ&quot;&quot;&quot;
    top = get_messages_top(chat_id, limit, db_path)

    if not top:
        return &quot;üìä –î–∞–Ω–Ω—ã—Ö –Ω–µ—Ç&quot;

    message = &quot;üìä &lt;b&gt;–¢–æ–ø –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º&lt;/b&gt;\n\n&quot;

    medals = [&quot;ü•á&quot;, &quot;ü•à&quot;, &quot;ü•â&quot;]

    for idx, (nik, msg_count) in enumerate(top, 1):
        medal = medals[idx - 1] if idx &lt;= 3 else f&quot;{idx}Ô∏è‚É£&quot;
        message += f&quot;{medal} &lt;b&gt;{nik}&lt;/b&gt; ‚Äî {msg_count} —Å–æ–æ–±—â–µ–Ω–∏–π\n&quot;

    return message
</code></pre>

<h4>–ü—Ä–∏–º–µ—Ä 3: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h4>
<pre class="codehilite"><code class="language-python">def get_activity_stats(chat_id: int, db_path: str = &quot;Base_bot.db&quot;) -&gt; dict:
    &quot;&quot;&quot;–ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ —á–∞—Ç–µ&quot;&quot;&quot;
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()

    table_name = str(-(chat_id))

    try:
        # –ù–∞—Ö–æ–¥–∏–º –∫–æ–ª–æ–Ω–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
        columns_info = cursor.execute(f&quot;PRAGMA table_info([{table_name}])&quot;).fetchall()
        column_names = [col[1] for col in columns_info]

        message_column = None
        for candidate in (&quot;mess_count&quot;, &quot;message_count&quot;, &quot;messages_count&quot;, &quot;msg_count&quot;, &quot;messages&quot;):
            if candidate in column_names:
                message_column = candidate
                break

        if not message_column:
            return {}

        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        stats = cursor.execute(
            f&quot;SELECT COUNT(*), SUM({message_column}), AVG({message_column}), MAX({message_column}) FROM [{table_name}]&quot;
        ).fetchone()

        users_count, total_messages, avg_messages, max_messages = stats

        return {
            &quot;total_users&quot;: users_count or 0,
            &quot;total_messages&quot;: total_messages or 0,
            &quot;avg_messages_per_user&quot;: round(avg_messages, 2) if avg_messages else 0,
            &quot;max_messages&quot;: max_messages or 0,
            &quot;activity_level&quot;: &quot;–í—ã—Å–æ–∫–∞—è&quot; if (total_messages or 0) / max(users_count or 1, 1) &gt; 50 else &quot;–°—Ä–µ–¥–Ω—è—è&quot;
        }
    finally:
        connection.close()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
stats = get_activity_stats(-1001234567890)
print(f&quot;–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {stats['total_users']}&quot;)
print(f&quot;–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π: {stats['total_messages']}&quot;)
print(f&quot;–°—Ä–µ–¥–Ω–µ–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {stats['avg_messages_per_user']}&quot;)
</code></pre>

<h4>–ü—Ä–∏–º–µ—Ä 4: –¢—Ä–µ–Ω–¥–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h4>
<pre class="codehilite"><code class="language-python">def get_trending_users(chat_id: int, limit: int = 5, db_path: str = &quot;Base_bot.db&quot;) -&gt; list:
    &quot;&quot;&quot;–ü–æ–ª—É—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º —Ä–æ—Å—Ç–æ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏&quot;&quot;&quot;
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()

    table_name = str(-(chat_id))

    try:
        # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É last_week_messages –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–æ—Å—Ç–∞
        # –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–ª—É—á–∞–µ–º —Å–∞–º—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö
        trending = cursor.execute(
            f&quot;SELECT nik, mess_count FROM [{table_name}] ORDER BY mess_count DESC LIMIT ?&quot;,
            (limit,)
        ).fetchall()

        return trending
    finally:
        connection.close()
</code></pre>

<hr />
<h2>üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü</h2>
<h3>–¢–∞–±–ª–∏—Ü–∞ —á–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä <code>[123456789]</code> –¥–ª—è chat_id = -123456789)</h3>
<pre class="codehilite"><code class="language-sql">CREATE TABLE [123456789] (
    tg_id INTEGER PRIMARY KEY,
    username TEXT,
    first_name TEXT,
    nik TEXT,
    mess_count INTEGER DEFAULT 0,
    -- –∏ –¥—Ä—É–≥–∏–µ –∫–æ–ª–æ–Ω–∫–∏...
)
</code></pre>

<hr />
<h2>üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</h2>
<h3>–ò–¥–µ—è 1: –ù–µ–¥–µ–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥</h3>
<pre class="codehilite"><code class="language-python">def add_weekly_tracking(chat_id: int, db_path: str = &quot;Base_bot.db&quot;):
    &quot;&quot;&quot;–î–æ–±–∞–≤–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–µ–¥–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏&quot;&quot;&quot;
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()

    table_name = str(-(chat_id))

    # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
    cursor.execute(f&quot;ALTER TABLE [{table_name}] ADD COLUMN week_messages INTEGER DEFAULT 0&quot;)
    cursor.execute(f&quot;ALTER TABLE [{table_name}] ADD COLUMN week_reset_date TEXT&quot;)

    connection.commit()
    connection.close()
</code></pre>

<h3>–ò–¥–µ—è 2: –ú–µ–¥–∞–ª–∏ –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
<pre class="codehilite"><code class="language-python">def get_user_medals(chat_id: int, user_nik: str, db_path: str = &quot;Base_bot.db&quot;) -&gt; list[str]:
    &quot;&quot;&quot;–ü–æ–ª—É—á–∞–µ—Ç –º–µ–¥–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è&quot;&quot;&quot;
    top = get_messages_top(chat_id, limit=100, db_path=db_path)

    medals = []

    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    for idx, (nik, msg_count) in enumerate(top, 1):
        if nik == user_nik:
            if idx == 1:
                medals.append(&quot;ü•á –ö–æ—Ä–æ–ª—å —á–∞—Ç–∞&quot;)
            elif idx == 2:
                medals.append(&quot;ü•à –í—Ç–æ—Ä–æ–π –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏&quot;)
            elif idx == 3:
                medals.append(&quot;ü•â –¢—Ä–µ—Ç–∏–π –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏&quot;)
            elif idx &lt;= 10:
                medals.append(&quot;‚≠ê –¢–æ–ø 10&quot;)

            # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
            if msg_count &gt;= 1000:
                medals.append(&quot;üí¨ 1000+ —Å–æ–æ–±—â–µ–Ω–∏–π&quot;)
            elif msg_count &gt;= 500:
                medals.append(&quot;üí¨ 500+ —Å–æ–æ–±—â–µ–Ω–∏–π&quot;)

    return medals
</code></pre>

<h3>–ò–¥–µ—è 3: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
<pre class="codehilite"><code class="language-python">def compare_users(chat_id: int, user1_nik: str, user2_nik: str, db_path: str = &quot;Base_bot.db&quot;) -&gt; dict:
    &quot;&quot;&quot;–°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π&quot;&quot;&quot;
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()

    table_name = str(-(chat_id))

    try:
        user1_data = cursor.execute(
            f&quot;SELECT nik, mess_count FROM [{table_name}] WHERE nik = ?&quot;,
            (user1_nik,)
        ).fetchone()

        user2_data = cursor.execute(
            f&quot;SELECT nik, mess_count FROM [{table_name}] WHERE nik = ?&quot;,
            (user2_nik,)
        ).fetchone()

        if not user1_data or not user2_data:
            return {}

        diff = user1_data[1] - user2_data[1]

        return {
            &quot;user1&quot;: {&quot;nik&quot;: user1_data[0], &quot;messages&quot;: user1_data[1]},
            &quot;user2&quot;: {&quot;nik&quot;: user2_data[0], &quot;messages&quot;: user2_data[1]},
            &quot;difference&quot;: abs(diff),
            &quot;leader&quot;: user1_data[0] if diff &gt; 0 else user2_data[0]
        }
    finally:
        connection.close()
</code></pre>

<hr />
<h2>üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º</h2>
<h3>–ü—Ä–æ–±–ª–µ–º–∞: "–¢–æ–ø –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ"</h3>
<p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∫–æ–ª–æ–Ω–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π</p>
<pre class="codehilite"><code class="language-python"># –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç –æ–¥–Ω—É –∏–∑ —ç—Ç–∏—Ö –∫–æ–ª–æ–Ω–æ–∫:
# mess_count, message_count, messages_count, msg_count, messages
</code></pre>

<h3>–ü—Ä–æ–±–ª–µ–º–∞: "–ü–æ–∏—Å–∫ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"</h3>
<p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞ –∫–æ–º–∞–Ω–¥—ã</p>
<pre class="codehilite"><code class="language-python"># ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
–±–æ—Ç –∫—Ç–æ –ò–≤–∞–Ω
–±–æ—Ç –∫—Ç–æ @username
–±–æ—Ç –∫—Ç–æ 123456  # –ü–æ ID

# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
–±–æ—Ç –∫—Ç–æ        # –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
</code></pre>

<hr />
<h2>üìù –õ–∏—Ü–µ–Ω–∑–∏—è</h2>
<p>–ß–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ WERTY | Chat-Manager Bot</p>
<hr />
<p><strong>–í–µ—Ä—Å–∏—è:</strong> 1.0<br />
<strong>–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ:</strong> GitHub Copilot<br />
<strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> 20.12.2025</p>
        </div>

        <div class="content">
            <div class="nav-buttons">
                <a href="../html/index_site.html" class="nav-button prev">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏</a>
                <a href="../html/index.html" class="nav-button">–ù–∞ –≥–ª–∞–≤–Ω—É—é ‚Üí</a>
            </div>
        </div>

        <footer>
            <p>Chat Manager Bot | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ | –í–µ—Ä—Å–∏—è 2.0</p>
            <p style="margin-top: 10px;">
                <a href="../html/index.html">–ì–ª–∞–≤–Ω–∞—è</a> | 
                <a href="../html/index_site.html">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</a> | 
                <a href="../html/modules.html">–ú–æ–¥—É–ª–∏</a>
            </p>
        </footer>
    </div>
</body>
</html>
