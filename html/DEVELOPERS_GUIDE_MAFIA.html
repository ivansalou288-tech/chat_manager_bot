<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé≠ –ú–æ–¥—É–ª—å Mafia (–ú–∞—Ñ–∏—è) - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .breadcrumb {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #ddd;
            font-size: 0.9em;
            color: #666;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .content {
            padding: 40px;
        }

        .content h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .content h2 {
            color: #764ba2;
            font-size: 1.6em;
            margin-top: 30px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            padding-left: 15px;
        }

        .content h3 {
            color: #667eea;
            font-size: 1.3em;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .content h4 {
            color: #764ba2;
            font-size: 1.1em;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        .content p {
            line-height: 1.8;
            margin: 15px 0;
            color: #444;
        }

        .content ul, .content ol {
            margin: 15px 0;
            margin-left: 30px;
            line-height: 1.8;
        }

        .content li {
            margin: 8px 0;
            color: #444;
        }

        .content code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
            font-size: 0.95em;
        }

        .content pre {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .content pre code {
            color: #333;
            padding: 0;
            background: none;
            font-size: 0.9em;
        }

        .content blockquote {
            border-left: 4px solid #667eea;
            padding-left: 20px;
            margin: 20px 0;
            color: #666;
            font-style: italic;
        }

        .content a {
            color: #667eea;
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .content a:hover {
            border-bottom-color: #667eea;
        }

        .content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .content table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
        }

        .content table td {
            border: 1px solid #ddd;
            padding: 12px;
        }

        .content table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .content hr {
            border: none;
            border-top: 2px solid #667eea;
            margin: 30px 0;
        }

        .content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 20px 0;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #ddd;
            justify-content: space-between;
        }

        .nav-button {
            display: inline-block;
            padding: 12px 24px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .nav-button:hover {
            background: #764ba2;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .nav-button.prev {
            margin-right: auto;
        }

        footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 0.9em;
        }

        footer a {
            color: #667eea;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .nav-buttons {
                flex-direction: column;
            }

            .nav-button.prev {
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé≠ –ú–æ–¥—É–ª—å Mafia (–ú–∞—Ñ–∏—è) - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</h1>
            <p style="opacity: 0.9; font-size: 1.1em;">Chat Manager Bot - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</p>
        </header>

        <div class="breadcrumb">
            <a href="../html/index.html">üè† –ì–ª–∞–≤–Ω–∞—è</a> / 
            <a href="../html/index_site.html">üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</a> / 
            <span>üé≠ –ú–æ–¥—É–ª—å Mafia (–ú–∞—Ñ–∏—è) - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</span>
        </div>

        <div class="content">
            
<p><strong>–í–µ—Ä—Å–∏—è:</strong> 1.0<br />
<strong>–î–∞—Ç–∞:</strong> 20.12.2025<br />
<strong>–°—Ç–∞—Ç—É—Å:</strong> ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production<br />
<strong>–Ø–∑—ã–∫:</strong> Python 3.10+  </p>
<hr />
<h2>üìñ –û–±–∑–æ—Ä</h2>
<p>–ú–æ–¥—É–ª—å Mafia (<code>modules/mafia.py</code>) —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Ä–æ–ª–µ–≤—É—é –∏–≥—Ä—É "–ú–∞—Ñ–∏—è" —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π 6+ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–æ–ª–µ–π, –Ω–æ—á–Ω—ã—Ö –∏ –¥–Ω–µ–≤–Ω—ã—Ö —Ñ–∞–∑, –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è –∏–≥—Ä—ã.</p>
<h3>–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h3>
<p>‚úÖ <strong>–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏</strong> - –ú–∏—Ä–Ω—ã–π, –î–æ–Ω, –ú–∞—Ñ–∏—è, –ö–æ–º–∏—Å—Å–∞—Ä, –î–æ–∫—Ç–æ—Ä, –ú–∞–Ω—å—è–∫<br />
‚úÖ <strong>–§–∞–∑—ã –∏–≥—Ä—ã</strong> - –ù–æ—á—å/–î–µ–Ω—å —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏<br />
‚úÖ <strong>–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</strong> - –î–Ω–µ–≤–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞<br />
‚úÖ <strong>–ù–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</strong> - –£–±–∏–π—Å—Ç–≤–∞, –ø—Ä–æ–≤–µ—Ä–∫–∏, –∑–∞—â–∏—Ç–∞<br />
‚úÖ <strong>–°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞</strong> - –£—á—ë—Ç —Ä–æ–ª–µ–π, –ø–æ–±–µ–¥–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π<br />
‚úÖ <strong>–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</strong> - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ë–î  </p>
<hr />
<h2>üé≠ –†–æ–ª–∏ –≤ –∏–≥—Ä–µ</h2>
<h3>–†–æ–ª–∏ –≥–æ—Ä–æ–∂–∞–Ω</h3>
<table>
<thead>
<tr>
<th>–†–æ–ª—å</th>
<th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
<th>–î–µ–π—Å—Ç–≤–∏–µ</th>
</tr>
</thead>
<tbody>
<tr>
<td>üë• –ú–∏—Ä–Ω—ã–π</td>
<td>–û–±—ã—á–Ω—ã–π –∂–∏—Ç–µ–ª—å –±–µ–∑ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π</td>
<td>–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –¥–Ω—ë–º</td>
</tr>
<tr>
<td>üïµÔ∏è –ö–æ–º–∏—Å—Å–∞—Ä</td>
<td>–°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å</td>
<td>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–ª—å –∏–ª–∏ —É–±–∏—Ç—å –Ω–æ—á—å—é</td>
</tr>
<tr>
<td>üè• –î–æ–∫—Ç–æ—Ä</td>
<td>–ó–∞—â–∏—Ç–Ω–∏–∫</td>
<td>–°–ø–∞—Å–∏—Ç—å –∏–≥—Ä–æ–∫–∞ –æ—Ç —É–±–∏–π—Å—Ç–≤–∞ –Ω–æ—á—å—é</td>
</tr>
</tbody>
</table>
<h3>–†–æ–ª–∏ –º–∞—Ñ–∏–∏</h3>
<table>
<thead>
<tr>
<th>–†–æ–ª—å</th>
<th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
<th>–î–µ–π—Å—Ç–≤–∏–µ</th>
</tr>
</thead>
<tbody>
<tr>
<td>üï¥ –î–æ–Ω</td>
<td>–ì–ª–∞–≤–∞ –º–∞—Ñ–∏–∏</td>
<td>–ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —É–±–∏–π—Å—Ç–≤–∞ –∏ –∑–Ω–∞–µ—Ç –¥—Ä—É–≥–∏—Ö</td>
</tr>
<tr>
<td>üíÄ –ú–∞—Ñ–∏—è</td>
<td>–ß–ª–µ–Ω –º–∞—Ñ–∏–∏</td>
<td>–£—á–∞—Å—Ç–≤—É–µ—Ç –≤ —É–±–∏–π—Å—Ç–≤–∞—Ö</td>
</tr>
</tbody>
</table>
<h3>–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ —Ä–æ–ª–∏</h3>
<table>
<thead>
<tr>
<th>–†–æ–ª—å</th>
<th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
<th>–î–µ–π—Å—Ç–≤–∏–µ</th>
</tr>
</thead>
<tbody>
<tr>
<td>üî™ –ú–∞–Ω—å—è–∫</td>
<td>–£–±–∏–π—Ü–∞-–æ–¥–∏–Ω–æ—á–∫–∞</td>
<td>–£–±–∏–≤–∞–µ—Ç –Ω–æ—á—å—é –¥–ª—è —Å–µ–±—è</td>
</tr>
</tbody>
</table>
<hr />
<h2>üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h2>
<h3>–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–µ–π</h3>
<pre class="codehilite"><code class="language-python">QUANTITY_OF_ROLES = {
    4: '2 1 0 0 1 0',  # 4 –∏–≥—Ä–æ–∫–∞: 2 –º–∏—Ä–Ω—ã—Ö, 1 –¥–æ–Ω, 0 –º–∞—Ñ–∏–∏, 0 –∫–æ–º–∏—Å—Å–∞—Ä, 1 –¥–æ–∫—Ç–æ—Ä, 0 –º–∞–Ω—å—è–∫
    5: '2 1 0 1 1 0',
    6: '3 1 0 1 1 0',
    7: '4 1 0 1 1 0',
    8: '4 1 1 1 1 0',
    9: '4 1 1 1 1 1',
    10: '4 1 2 1 1 1'
}

def parse_roles(count: int) -&gt; dict:
    &quot;&quot;&quot;–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å—Ç—Ä–æ–∫—É —Ä–æ–ª–µ–π –≤ —Å–ª–æ–≤–∞—Ä—å&quot;&quot;&quot;
    if count not in QUANTITY_OF_ROLES:
        return {}

    roles_str = QUANTITY_OF_ROLES[count]
    mirny, don, mafia, police, doctor, maniak = map(int, roles_str.split())

    return {
        'mirny': mirny,
        'don': don,
        'mafia': mafia,
        'police': police,
        'doctor': doctor,
        'maniak': maniak
    }
</code></pre>

<h3>–ü–æ—Ç–æ–∫ –∏–≥—Ä—ã</h3>
<pre class="codehilite"><code>–ò–≥—Ä–æ–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è
         ‚Üì
–†–æ–ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ
         ‚Üì
–ù–û–ß–¨ 1: –î–µ–π—Å—Ç–≤–∏—è –º–∞—Ñ–∏–∏, –¥–æ–∫—Ç–æ—Ä–∞, –∫–æ–º–∏—Å—Å–∞—Ä–∞
         ‚Üì
–î–ï–ù–¨ 1: –í—Å–µ –≥–æ–ª–æ—Å—É—é—Ç –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
         ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è –ø–æ–±–µ–¥—ã
         ‚Üì
–ù–û–ß–¨ 2: –ù–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è
         ‚Üì
–î–ï–ù–¨ 2: –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
         ‚Üì
... (–ò–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è)
         ‚Üì
–ü–æ–±–µ–∂–¥–∞—é—Ç –≥–æ—Ä–æ–∂–∞–Ω–µ –ò–õ–ò –º–∞—Ñ–∏—è –ò–õ–ò –º–∞–Ω—å—è–∫
</code></pre>

<hr />
<h2>üíª –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h2>
<h3>–ü—Ä–∏–º–µ—Ä 1: –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã</h3>
<pre class="codehilite"><code class="language-python">async def start_mafia_game(chat_id: int, players: list[int], bot: Bot) -&gt; bool:
    &quot;&quot;&quot;–ù–∞—á–∏–Ω–∞–µ—Ç –Ω–æ–≤—É—é –∏–≥—Ä—É –º–∞—Ñ–∏–∏&quot;&quot;&quot;
    player_count = len(players)

    if player_count &lt; 4:
        return False  # –ú–∏–Ω–∏–º—É–º 4 –∏–≥—Ä–æ–∫–∞

    # –ü–æ–ª—É—á–∞–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π
    roles_dist = parse_roles(player_count)

    # –°–æ–∑–¥–∞—ë–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–æ–ª–µ–π
    all_roles = (
        ['mirny'] * roles_dist['mirny'] +
        ['don'] * roles_dist['don'] +
        ['mafia'] * roles_dist['mafia'] +
        ['police'] * roles_dist['police'] +
        ['doctor'] * roles_dist['doctor'] +
        ['maniak'] * roles_dist['maniak']
    )

    # –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º —Ä–æ–ª–∏
    random.shuffle(all_roles)

    # –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∂–¥–æ–º—É –∏–≥—Ä–æ–∫—É
    player_roles = {player_id: role for player_id, role in zip(players, all_roles)}

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ä–æ–ª—è–º–∏
    for player_id, role in player_roles.items():
        role_info = ROLES_ABOUT.get(role, &quot;–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä–æ–ª—å&quot;)
        await bot.send_message(player_id, f&quot;üé≠ –í–∞—à–∞ —Ä–æ–ª—å: {role_info}&quot;)

    return True
</code></pre>

<h3>–ü—Ä–∏–º–µ—Ä 2: –ù–æ—á–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –º–∞—Ñ–∏–∏</h3>
<pre class="codehilite"><code class="language-python">async def mafia_night_vote(game_id: str, db_path: str) -&gt; int:
    &quot;&quot;&quot;–ü—Ä–æ–≤–æ–¥–∏—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –º–∞—Ñ–∏–∏ –∑–∞ –∂–µ—Ä—Ç–≤—É&quot;&quot;&quot;
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()

    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –∂–∏–≤—ã—Ö —á–ª–µ–Ω–æ–≤ –º–∞—Ñ–∏–∏
    mafia_members = cursor.execute(
        &quot;SELECT user_id FROM mafia_game_players WHERE game_id = ? AND role IN ('don', 'mafia') AND alive = 1&quot;,
        (game_id,)
    ).fetchall()

    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –∂–∏–≤—ã—Ö –≥–æ—Ä–æ–∂–∞–Ω (–∫—Ä–æ–º–µ –º–∞—Ñ–∏–∏)
    possible_victims = cursor.execute(
        &quot;SELECT user_id FROM mafia_game_players WHERE game_id = ? AND role NOT IN ('don', 'mafia') AND alive = 1&quot;,
        (game_id,)
    ).fetchall()

    # –ö–∞–∂–¥—ã–π —á–ª–µ–Ω –º–∞—Ñ–∏–∏ –≥–æ–ª–æ—Å—É–µ—Ç
    votes = {}
    for member_id, in mafia_members:
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∂–µ—Ä—Ç–≤—É
        victim_id = random.choice(possible_victims)[0]
        votes[victim_id] = votes.get(victim_id, 0) + 1

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∂–µ—Ä—Ç–≤—É —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≥–æ–ª–æ—Å–æ–≤
    if votes:
        victim_id = max(votes, key=votes.get)
        return victim_id

    connection.close()
    return None
</code></pre>

<h3>–ü—Ä–∏–º–µ—Ä 3: –î–Ω–µ–≤–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</h3>
<pre class="codehilite"><code class="language-python">async def day_voting(game_id: str, votes: dict[int, int], db_path: str) -&gt; int:
    &quot;&quot;&quot;–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–Ω–µ–≤–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ&quot;&quot;&quot;
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()

    # –ù–∞—Ö–æ–¥–∏–º –∏–≥—Ä–æ–∫–∞ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≥–æ–ª–æ—Å–æ–≤
    if not votes:
        return None

    voted_out = max(votes, key=votes.get)
    vote_count = votes[voted_out]

    # –£–¥–∞–ª—è–µ–º –∏–≥—Ä–æ–∫–∞ –∏–∑ –∂–∏–≤—ã—Ö
    cursor.execute(
        &quot;UPDATE mafia_game_players SET alive = 0 WHERE game_id = ? AND user_id = ?&quot;,
        (game_id, voted_out)
    )

    # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏—Å–∫–ª—é—á—ë–Ω–Ω–æ–º –∏–≥—Ä–æ–∫–µ
    player_info = cursor.execute(
        &quot;SELECT user_id, nik, role FROM mafia_game_players WHERE game_id = ? AND user_id = ?&quot;,
        (game_id, voted_out)
    ).fetchone()

    connection.commit()
    connection.close()

    return player_info
</code></pre>

<h3>–ü—Ä–∏–º–µ—Ä 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è –ø–æ–±–µ–¥—ã</h3>
<pre class="codehilite"><code class="language-python">def check_win_condition(game_id: str, db_path: str) -&gt; tuple[bool, str]:
    &quot;&quot;&quot;–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤—ã–∏–≥—Ä–∞–ª–∞ –ª–∏ –∫–∞–∫–∞—è-—Ç–æ —Å—Ç–æ—Ä–æ–Ω–∞&quot;&quot;&quot;
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()

    # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∂–∏–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –ø–æ —Ä–æ–ª—è–º
    alive_counts = cursor.execute('''
        SELECT role, COUNT(*) FROM mafia_game_players 
        WHERE game_id = ? AND alive = 1
        GROUP BY role
    ''', (game_id,)).fetchall()

    alive_by_role = {role: count for role, count in alive_counts}

    mafia_alive = alive_by_role.get('don', 0) + alive_by_role.get('mafia', 0)
    townspeople_alive = sum(count for role, count in alive_by_role.items() 
                           if role not in ['don', 'mafia'])
    maniak_alive = alive_by_role.get('maniak', 0)

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –ø–æ–±–µ–¥—ã
    if mafia_alive == 0:
        connection.close()
        return True, &quot;–ì–æ—Ä–æ–∂–∞–Ω–µ –≤—ã–∏–≥—Ä–∞–ª–∏! –ú–∞—Ñ–∏—è —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞!&quot;

    if mafia_alive &gt;= townspeople_alive:
        connection.close()
        return True, &quot;–ú–∞—Ñ–∏—è –≤—ã–∏–≥—Ä–∞–ª–∞!&quot;

    if maniak_alive &gt; 0 and townspeople_alive + mafia_alive == 1:
        connection.close()
        return True, &quot;–ú–∞–Ω—å—è–∫ –≤—ã–∏–≥—Ä–∞–ª!&quot;

    connection.close()
    return False, None
</code></pre>

<hr />
<h2>üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h2>
<h3>–¢–∞–±–ª–∏—Ü–∞ <code>mafia_game_players</code></h3>
<pre class="codehilite"><code class="language-sql">CREATE TABLE IF NOT EXISTS mafia_game_players (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    game_id TEXT NOT NULL,
    chat_id INTEGER NOT NULL,
    user_id INTEGER NOT NULL,
    nik TEXT,
    role TEXT NOT NULL,
    alive INTEGER DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
</code></pre>

<h3>–¢–∞–±–ª–∏—Ü–∞ <code>mafia_game_actions</code></h3>
<pre class="codehilite"><code class="language-sql">CREATE TABLE IF NOT EXISTS mafia_game_actions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    game_id TEXT NOT NULL,
    night_number INTEGER NOT NULL,
    actor_id INTEGER NOT NULL,
    action TEXT NOT NULL,
    target_id INTEGER,
    result TEXT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
</code></pre>

<hr />
<h2>üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</h2>
<h3>–ò–¥–µ—è 1: –ù–æ–≤—ã–µ —Ä–æ–ª–∏</h3>
<pre class="codehilite"><code class="language-python">EXTENDED_ROLES = {
    # ... —Å—Ç–∞—Ä—ã–µ —Ä–æ–ª–∏ ...
    &quot;love&quot;: &quot;üíï –í–ª—é–±–ª—ë–Ω–Ω—ã–µ - –ø–∞—Ä–∞ –∏–≥—Ä–æ–∫–æ–≤, –∑–∞—â–∏—â–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞&quot;,
    &quot;witch&quot;: &quot;üßô –í–µ–¥—å–º–∞ - –º–æ–∂–µ—Ç —Å–ø–∞—Å—Ç–∏ –∏–ª–∏ –ø—Ä–æ–∫–ª—è—Å—Ç—å&quot;,
    &quot;informant&quot;: &quot;üïµÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ç–æ—Ä - –∑–Ω–∞–µ—Ç –æ–¥–Ω–æ–≥–æ —á–ª–µ–Ω–∞ –º–∞—Ñ–∏–∏&quot;
}
</code></pre>

<h3>–ò–¥–µ—è 2: –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</h3>
<pre class="codehilite"><code class="language-python">def get_player_mafia_stats(user_id: int, db_path: str) -&gt; dict:
    &quot;&quot;&quot;–ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä–æ–∫–∞ –≤ –º–∞—Ñ–∏–∏&quot;&quot;&quot;
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()

    stats = cursor.execute('''
        SELECT role, COUNT(*) as games, SUM(CASE WHEN alive = 1 THEN 1 ELSE 0 END) as wins
        FROM mafia_game_players
        WHERE user_id = ?
        GROUP BY role
    ''', (user_id,)).fetchall()

    connection.close()

    return {role: {&quot;games&quot;: games, &quot;wins&quot;: wins} for role, games, wins in stats}
</code></pre>

<h3>–ò–¥–µ—è 3: –†–µ–π—Ç–∏–Ω–≥ –ª—É—á—à–∏—Ö –∏–≥—Ä–æ–∫–æ–≤</h3>
<pre class="codehilite"><code class="language-python">def get_mafia_leaderboard(chat_id: int, limit: int = 10, db_path: str = &quot;mafia.db&quot;) -&gt; list:
    &quot;&quot;&quot;–ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –ª—É—á—à–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –º–∞—Ñ–∏–∏&quot;&quot;&quot;
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()

    leaders = cursor.execute('''
        SELECT user_id, COUNT(*) as games_played, 
               SUM(CASE WHEN alive = 1 THEN 1 ELSE 0 END) as wins
        FROM mafia_game_players
        WHERE chat_id = ?
        GROUP BY user_id
        ORDER BY wins DESC
        LIMIT ?
    ''', (chat_id, limit)).fetchall()

    connection.close()
    return leaders
</code></pre>

<hr />
<h2>üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º</h2>
<h3>–ü—Ä–æ–±–ª–µ–º–∞: "–†–æ–ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ"</h3>
<p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ—Ç–µ —Å–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π</p>
<pre class="codehilite"><code class="language-python">random.shuffle(all_roles)  # ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!
</code></pre>

<h3>–ü—Ä–æ–±–ª–µ–º–∞: "–ò–≥—Ä–∞ –Ω–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è"</h3>
<p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —É—Å–ª–æ–≤–∏–µ –ø–æ–±–µ–¥—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è</p>
<pre class="codehilite"><code class="language-python">won, message = check_win_condition(game_id, db_path)
if won:
    await notify_game_end(chat_id, message)
    delete_game(game_id)
</code></pre>

<hr />
<h2>üìù –õ–∏—Ü–µ–Ω–∑–∏—è</h2>
<p>–ß–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ WERTY | Chat-Manager Bot</p>
<hr />
<p><strong>–í–µ—Ä—Å–∏—è:</strong> 1.0<br />
<strong>–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ:</strong> GitHub Copilot<br />
<strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> 20.12.2025</p>
        </div>

        <div class="content">
            <div class="nav-buttons">
                <a href="../html/index_site.html" class="nav-button prev">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏</a>
                <a href="../html/index.html" class="nav-button">–ù–∞ –≥–ª–∞–≤–Ω—É—é ‚Üí</a>
            </div>
        </div>

        <footer>
            <p>Chat Manager Bot | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ | –í–µ—Ä—Å–∏—è 2.0</p>
            <p style="margin-top: 10px;">
                <a href="../html/index.html">–ì–ª–∞–≤–Ω–∞—è</a> | 
                <a href="../html/index_site.html">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</a> | 
                <a href="../html/modules.html">–ú–æ–¥—É–ª–∏</a>
            </p>
        </footer>
    </div>
</body>
</html>
