# üìå –ú–æ–¥—É–ª—å –∑–∞–∫–ª–∞–¥–æ–∫ - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 20.12.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production  
**–Ø–∑—ã–∫:** Python 3.10+  

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [API –∫–ª–∞—Å—Å–∞ BookmarkManager](#api-–∫–ª–∞—Å—Å–∞-bookmarkmanager)
4. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
5. [–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π](#–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏-—Å–æ–æ–±—â–µ–Ω–∏–π)
6. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
7. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
8. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
9. [–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏](#—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)

---

## üìñ –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å –∑–∞–∫–ª–∞–¥–æ–∫ (`modules/bookmarks.py`) –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —á–∞—Ç–æ–≤ –ø—É—Ç—ë–º –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –Ω–∏—Ö —Å–æ –∑–Ω–∞—á–∫–æ–º üìå. –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∑–∞–∫–ª–∞–¥–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `bookmarks` –≤ `Base_bot.db` —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º `message_id` –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π** - –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å üìå  
‚úÖ **–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–ª–∞–¥–æ–∫** - –∫–æ–º–∞–Ω–¥—ã `/bookmarks` –∏–ª–∏ `/–∑–∞–∫–ª–∞–¥–∫–∏`  
‚úÖ **–ù–∞–≤–∏–≥–∞—Ü–∏—è** - —Ñ–æ—Ä–≤–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è  
‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–ª–∞–¥–æ–∫ –∏–∑ —Å–ø–∏—Å–∫–∞  
‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** - UNIQUE constraint –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î  
‚úÖ **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞** - –∑–∞–∫–ª–∞–¥–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º  

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
modules/bookmarks.py
‚îú‚îÄ‚îÄ –ö–ª–∞—Å—Å BookmarkManager
‚îÇ   ‚îú‚îÄ‚îÄ __init__()          - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ init_db()           - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
‚îÇ   ‚îú‚îÄ‚îÄ add_bookmark()      - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–ª–∞–¥–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ remove_bookmark()   - —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–ª–∞–¥–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ get_user_bookmarks() - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–∫–ª–∞–¥–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ is_bookmarked()     - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è
‚îÇ
‚îú‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ add_bookmark_handler()
‚îÇ   ‚îî‚îÄ‚îÄ –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞ –æ—Ç–≤–µ—Ç —Å üìå
‚îÇ
‚îú‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ show_bookmarks_handler()
‚îÇ   ‚îî‚îÄ‚îÄ –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã /bookmarks –∏–ª–∏ /–∑–∞–∫–ª–∞–¥–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ go_to_bookmark_handler()
‚îÇ   ‚îî‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∑–∞–∫–ª–∞–¥–∫—É (–ø–µ—Ä–µ—Ö–æ–¥)
‚îÇ
‚îî‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ delete_bookmark_handler()
    ‚îî‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ ‚ùå (—É–¥–∞–ª–µ–Ω–∏–µ)
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç üìå –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
         ‚Üì
    add_bookmark_handler()
         ‚Üì
    BookmarkManager.add_bookmark()
         ‚Üì
    INSERT –≤ —Ç–∞–±–ª–∏—Ü—É bookmarks
         ‚Üì
    ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–ª–∏ ‚ö†Ô∏è –û—à–∏–±–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
```

---

## üîå API –∫–ª–∞—Å—Å–∞ BookmarkManager

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```python
from modules.bookmarks import BookmarkManager

# –° –ø—É—Ç—ë–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (Base_bot.db)
manager = BookmarkManager()

# –° –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –ø—É—Ç—ë–º
manager = BookmarkManager(db_path="/custom/path/database.db")
```

### init_db()

–°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `bookmarks` –µ—Å–ª–∏ –µ—ë –µ—â—ë –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

```python
manager.init_db()
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –Ω–µ—Ç  
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `None`  
**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:** –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å `sqlite3.Error` –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ë–î  

### add_bookmark()

–î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é –∑–∞–∫–ª–∞–¥–∫—É.

```python
success = manager.add_bookmark(
    user_id=123456,
    chat_id=-1001234567890,
    message_id=999,
    message_text="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
    author_id=111111,
    author_name="@username"
)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (int): ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ—Ö—Ä–∞–Ω—è—é—â–µ–≥–æ –∑–∞–∫–ª–∞–¥–∫—É
- `chat_id` (int): ID —á–∞—Ç–∞, –æ—Ç–∫—É–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
- `message_id` (int): ID —Å–æ–æ–±—â–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ñ–æ—Ä–≤–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è)
- `message_text` (str, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –¢–µ–∫—Å—Ç –∏–ª–∏ –ø—Ä–µ–≤—å—é —Å–æ–æ–±—â–µ–Ω–∏—è
- `author_id` (int, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): ID –∞–≤—Ç–æ—Ä–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- `author_name` (str, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ò–º—è –∏–ª–∏ —é–∑–µ—Ä–Ω–µ–π–º –∞–≤—Ç–æ—Ä–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** 
- `True` - –µ—Å–ª–∏ –∑–∞–∫–ª–∞–¥–∫–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞
- `False` - –µ—Å–ª–∏ –∑–∞–∫–ª–∞–¥–∫–∞ —Å —ç—Ç–∏–º message_id —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:** `sqlite3.Error` –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ë–î

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- UNIQUE constraint –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `created_at = CURRENT_TIMESTAMP`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π

### remove_bookmark()

–£–¥–∞–ª—è–µ—Ç –∑–∞–∫–ª–∞–¥–∫—É –ø–æ ID —Å–æ–æ–±—â–µ–Ω–∏—è.

```python
deleted = manager.remove_bookmark(
    user_id=123456,
    chat_id=-1001234567890,
    message_id=999
)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (int): ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `chat_id` (int): ID —á–∞—Ç–∞
- `message_id` (int): ID —Å–æ–æ–±—â–µ–Ω–∏—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `True` - –µ—Å–ª–∏ –∑–∞–∫–ª–∞–¥–∫–∞ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞
- `False` - –µ—Å–ª–∏ –∑–∞–∫–ª–∞–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:** `sqlite3.Error` –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ë–î

### get_user_bookmarks()

–ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–∫–ª–∞–¥–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è.

```python
bookmarks = manager.get_user_bookmarks(user_id=123456)
for bookmark_id, user_id, chat_id, msg_id, msg_text, author_id, author_name, created_at in bookmarks:
    print(f"{msg_text} –æ—Ç {author_name}")
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (int): ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** 
- `list` - —Å–ø–∏—Å–æ–∫ –∫–æ—Ä—Ç–µ–∂–µ–π, –∫–∞–∂–¥—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç:
  ```
  (id, user_id, chat_id, message_id, message_text, author_id, author_name, created_at)
  ```
  - `id` (int): –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID –∑–∞–∫–ª–∞–¥–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
  - `user_id` (int): ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `chat_id` (int): ID —á–∞—Ç–∞
  - `message_id` (int): ID —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ
  - `message_text` (str): –¢–µ–∫—Å—Ç –∏–ª–∏ –ø—Ä–µ–≤—å—é —Å–æ–æ–±—â–µ–Ω–∏—è
  - `author_id` (int): ID –∞–≤—Ç–æ—Ä–∞
  - `author_name` (str): –ò–º—è/—é–∑–µ—Ä–Ω–µ–π–º –∞–≤—Ç–æ—Ä–∞
  - `created_at` (str): ISO timestamp —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–ª–∞–¥–∫–∏

**–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:** –ü–æ `created_at DESC` (–Ω–æ–≤—ã–µ –≤ –Ω–∞—á–∞–ª–µ)  
**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:** `sqlite3.Error` –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ë–î

### is_bookmarked()

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∑–∞–∫–ª–∞–¥–∫–∞.

```python
exists = manager.is_bookmarked(
    user_id=123456,
    chat_id=-1001234567890,
    message_id=999
)
if exists:
    print("–ó–∞–∫–ª–∞–¥–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (int): ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `chat_id` (int): ID —á–∞—Ç–∞
- `message_id` (int): ID —Å–æ–æ–±—â–µ–Ω–∏—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `True` - –µ—Å–ª–∏ –∑–∞–∫–ª–∞–¥–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `False` - –µ—Å–ª–∏ –∑–∞–∫–ª–∞–¥–∫–∏ –Ω–µ—Ç

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:** `sqlite3.Error` –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ë–î

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `bookmarks`

```sql
CREATE TABLE IF NOT EXISTS bookmarks (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    chat_id INTEGER NOT NULL,
    message_id INTEGER NOT NULL,
    message_text TEXT,
    author_id INTEGER,
    author_name TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, chat_id, message_id)
)
```

### –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫

| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|---------|
| `id` | INTEGER | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞–∫–ª–∞–¥–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ |
| `user_id` | INTEGER | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–ª –∑–∞–∫–ª–∞–¥–∫—É |
| `chat_id` | INTEGER | ID —á–∞—Ç–∞, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –¥–ª—è –≥—Ä—É–ø–ø) |
| `message_id` | INTEGER | ID —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–æ—Ä–≤–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è |
| `message_text` | TEXT | –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–ª–∏ –ø–µ—Ä–≤—ã–µ N —Å–∏–º–≤–æ–ª–æ–≤ –ø—Ä–µ–≤—å—é |
| `author_id` | INTEGER | ID –∞–≤—Ç–æ—Ä–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è |
| `author_name` | TEXT | –Æ–∑–µ—Ä–Ω–µ–π–º –∏–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –∞–≤—Ç–æ—Ä–∞ |
| `created_at` | TIMESTAMP | –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–ª–∞–¥–∫–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è) |

### –ò–Ω–¥–µ–∫—Å—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

**–ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á:** `id`  
**UNIQUE constraint:** `(user_id, chat_id, message_id)`
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ: –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–≤–∞–∂–¥—ã

### –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–∏–º–µ—Ä 1: –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
INSERT INTO bookmarks (user_id, chat_id, message_id, message_text, author_id, author_name, created_at)
VALUES (123456, -1001234567890, 999, "–í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", 111111, "@important_user", "2025-12-20 15:30:00");

-- –ü—Ä–∏–º–µ—Ä 2: –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
INSERT INTO bookmarks (user_id, chat_id, message_id, message_text, author_id, author_name, created_at)
VALUES (123456, -1001234567890, 1000, "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ...", 222222, "@admin", "2025-12-20 16:45:00");

-- –ü—Ä–∏–º–µ—Ä 3: –°–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —á–∞—Ç–∞
INSERT INTO bookmarks (user_id, chat_id, message_id, message_text, author_id, author_name, created_at)
VALUES (123456, 987654321, 500, "–õ–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ", 333333, "@friend", "2025-12-20 17:20:00");
```

---

## üéØ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

### add_bookmark_handler()

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–ª–∞–¥–∫–∏ –æ—Ç–≤–µ—Ç–æ–º —Å üìå.

```python
@dp.message_handler(lambda message: message.reply_to_message is not None and 
                                   message.text and 
                                   message.text.lower() == 'üìå')
async def add_bookmark_handler(message: types.Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–ª–∞–¥–∫–∏ –ø—É—Ç—ë–º –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏ üìå
    """
```

**–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞:**
- –°–æ–æ–±—â–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ –¥—Ä—É–≥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —ç–º–æ–¥–∑–∏ üìå

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
2. –í—ã–∑—ã–≤–∞–µ—Ç `bookmark_manager.add_bookmark()`
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

**–û—Ç–≤–µ—Ç—ã –±–æ—Ç–∞:**
- ‚úÖ **–£—Å–ø–µ—Ö:** "‚úÖ –ó–∞–∫–ª–∞–¥–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!"
- ‚ö†Ô∏è **–î—É–±–ª–∏–∫–∞—Ç:** "‚ö†Ô∏è –≠—Ç–∞ –∑–∞–∫–ª–∞–¥–∫–∞ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!"
- ‚ùå **–û—à–∏–±–∫–∞:** "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–∫–ª–∞–¥–∫–∏"

### show_bookmarks_handler()

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–∫–ª–∞–¥–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```python
@dp.message_handler(commands=['bookmarks', '–∑–∞–∫–ª–∞–¥–∫–∏'])
async def show_bookmarks_handler(message: types.Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–æ–º–∞–Ω–¥ /bookmarks –∏ /–∑–∞–∫–ª–∞–¥–∫–∏
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–∫–ª–∞–¥–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    """
```

**–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—à–µ—Ç `/bookmarks` –∏–ª–∏ `/–∑–∞–∫–ª–∞–¥–∫–∏`

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–∫–ª–∞–¥–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –°–æ–∑–¥–∞—ë—Ç Inline Keyboard —Å –∫–Ω–æ–ø–∫–∞–º–∏
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
üìå –¢–≤–æ–∏ –∑–∞–∫–ª–∞–¥–∫–∏ (N)

[–ö–Ω–æ–ø–∫–∞] –¢–µ–∫—Å—Ç –∑–∞–∫–ª–∞–¥–∫–∏... - @–∞–≤—Ç–æ—Ä [‚ùå]
[–ö–Ω–æ–ø–∫–∞] –î—Ä—É–≥–∞—è –∑–∞–∫–ª–∞–¥–∫–∞... - @–∞–≤—Ç–æ—Ä2 [‚ùå]
...
```

**–ï—Å–ª–∏ –∑–∞–∫–ª–∞–¥–æ–∫ –Ω–µ—Ç:**
```
üìå –£ —Ç–µ–±—è –Ω–µ—Ç –∑–∞–∫–ª–∞–¥–æ–∫

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–ª–∞–¥–∫—É, –æ—Ç–≤–µ—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–µ–º üìå
```

### go_to_bookmark_handler()

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é.

```python
@dp.callback_query_handler(lambda call: call.data.startswith('bookmark_go_'))
async def go_to_bookmark_handler(call: types.CallbackQuery):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∑–∞–∫–ª–∞–¥–∫—É
    –§–æ—Ä–≤–∞—Ä–¥–∏—Ä—É–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
```

**–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞:**
- –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ —Å –∑–∞–∫–ª–∞–¥–∫–æ–π (–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–∞ `bookmark_go_<index>`)

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–ª–∞–¥–∫–µ –∏–∑ —Å–ø–∏—Å–∫–∞
2. –§–æ—Ä–≤–∞—Ä–¥–∏—Ä—É–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –õ–° –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–ª–∏ –æ—à–∏–±–∫—É

**–û—Ç–≤–µ—Ç—ã –±–æ—Ç–∞:**
- ‚úÖ "‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è"
- ‚ùå "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ–Ω–æ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ)"

### delete_bookmark_handler()

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–∫–ª–∞–¥–∫–∏.

```python
@dp.callback_query_handler(lambda call: call.data.startswith('bookmark_del_'))
async def delete_bookmark_handler(call: types.CallbackQuery):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–∫–ª–∞–¥–∫–∏ –Ω–∞–∂–∞—Ç–∏–µ–º –∫–Ω–æ–ø–∫–∏ ‚ùå
    """
```

**–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞:**
- –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ ‚ùå —Ä—è–¥–æ–º —Å –∑–∞–∫–ª–∞–¥–∫–æ–π (–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–∞ `bookmark_del_<index>`)

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–ª–∞–¥–∫–µ –∏–∑ —Å–ø–∏—Å–∫–∞
2. –£–¥–∞–ª—è–µ—Ç –∑–∞–∫–ª–∞–¥–∫—É –∏–∑ –ë–î
3. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–∫–ª–∞–¥–æ–∫ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏

**–û—Ç–≤–µ—Ç—ã –±–æ—Ç–∞:**
- ‚úÖ "‚úÖ –ó–∞–∫–ª–∞–¥–∫–∞ —É–¥–∞–ª–µ–Ω–∞" (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫)
- ‚ùå "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–∫–ª–∞–¥–∫–∏"

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–ª–∞–¥–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ

```python
from modules.bookmarks import BookmarkManager

manager = BookmarkManager()

# –î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–ª–∞–¥–∫—É –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
async def my_handler(message: types.Message):
    if message.reply_to_message:
        success = manager.add_bookmark(
            user_id=message.from_user.id,
            chat_id=message.chat.id,
            message_id=message.reply_to_message.message_id,
            message_text=message.reply_to_message.text[:50],
            author_id=message.reply_to_message.from_user.id,
            author_name=message.reply_to_message.from_user.username or "Unknown"
        )
        
        if success:
            await message.reply("‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∑–∞–∫–ª–∞–¥–∫–∏!")
        else:
            await message.reply("‚ö†Ô∏è –£–∂–µ –≤ –∑–∞–∫–ª–∞–¥–∫–∞—Ö")
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–ª–∞–¥–æ–∫

```python
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–∫–ª–∞–¥–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
bookmarks = manager.get_user_bookmarks(user_id=123456)

if bookmarks:
    for idx, (bm_id, user_id, chat_id, msg_id, msg_text, author_id, author_name, created_at) in enumerate(bookmarks, 1):
        print(f"{idx}. {msg_text[:40]}... –æ—Ç {author_name}")
        print(f"   –°–æ–∑–¥–∞–Ω–æ: {created_at}")
        print(f"   Chat ID: {chat_id}, Message ID: {msg_id}\n")
else:
    print("–ó–∞–∫–ª–∞–¥–æ–∫ –Ω–µ—Ç")
```

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∑–∞–∫–ª–∞–¥–∫–∏

```python
# –ü–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∑–∞–∫–ª–∞–¥–∫–∏
user_id = message.from_user.id
chat_id = message.chat.id
msg_id = message.reply_to_message.message_id

if manager.is_bookmarked(user_id, chat_id, msg_id):
    await message.reply("üìå –£–∂–µ –≤ –∑–∞–∫–ª–∞–¥–∫–∞—Ö")
else:
    manager.add_bookmark(user_id, chat_id, msg_id)
    await message.reply("‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∑–∞–∫–ª–∞–¥–∫–∏")
```

### –ü—Ä–∏–º–µ—Ä 4: –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–∫–ª–∞–¥–æ–∫

```python
from datetime import datetime, timedelta
import sqlite3

def cleanup_old_bookmarks(days=30):
    """–£–¥–∞–ª—è–µ—Ç –∑–∞–∫–ª–∞–¥–∫–∏ —Å—Ç–∞—Ä—à–µ N –¥–Ω–µ–π"""
    cutoff_date = (datetime.now() - timedelta(days=days)).isoformat()
    
    conn = sqlite3.connect(manager.db_path, check_same_thread=False)
    cursor = conn.cursor()
    
    cursor.execute("DELETE FROM bookmarks WHERE created_at < ?", (cutoff_date,))
    deleted_count = cursor.rowcount
    
    conn.commit()
    conn.close()
    
    return deleted_count

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
deleted = cleanup_old_bookmarks(days=60)
print(f"–£–¥–∞–ª–µ–Ω–æ {deleted} —Å—Ç–∞—Ä—ã—Ö –∑–∞–∫–ª–∞–¥–æ–∫")
```

### –ü—Ä–∏–º–µ—Ä 5: –ü–æ–∏—Å–∫ –∑–∞–∫–ª–∞–¥–æ–∫ –ø–æ —Ç–µ–∫—Å—Ç—É

```python
def search_bookmarks(user_id, query):
    """–ü–æ–∏—Å–∫ –∑–∞–∫–ª–∞–¥–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ç–µ–∫—Å—Ç—É"""
    conn = sqlite3.connect(manager.db_path, check_same_thread=False)
    cursor = conn.cursor()
    
    cursor.execute(
        "SELECT * FROM bookmarks WHERE user_id = ? AND message_text LIKE ?",
        (user_id, f"%{query}%")
    )
    results = cursor.fetchall()
    conn.close()
    
    return results

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
results = search_bookmarks(123456, "–≤–∞–∂–Ω–æ–µ")
for bm in results:
    print(f"–ù–∞–π–¥–µ–Ω–æ: {bm[4]}")
```

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ main_bot.py

```python
# main/main_bot.py

from modules.bookmarks import BookmarkManager
import modules.bookmarks  # –≠—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

# –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞...

if __name__ == '__main__':
    print("Starting bot...")
    dp.start_polling()
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ:**
1. –°–æ–∑–¥–∞—ë—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä `BookmarkManager`
2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ `bookmarks` –≤ –ë–î
3. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è 4 –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
4. –í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```python
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–æ–¥—É–ª—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
try:
    from modules.bookmarks import BookmarkManager
    print("‚úÖ –ú–æ–¥—É–ª—å —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω")
    
    manager = BookmarkManager()
    print("‚úÖ BookmarkManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
python test_bookmarks.py
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

```
‚úì –¢–µ—Å—Ç 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–ª–∞–¥–∫–∏
  –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ó–∞–∫–ª–∞–¥–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞

‚úì –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∑–∞–∫–ª–∞–¥–∫–∏
  –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ó–∞–∫–ª–∞–¥–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

‚úì –¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–∫–ª–∞–¥–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–ª–∞–¥–æ–∫: 1

‚úì –¢–µ—Å—Ç 4: –ü–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â—É—é—Å—è –∑–∞–∫–ª–∞–¥–∫—É
  –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ùå –î—É–±–ª–∏—Ä—É—é—â–∞—è—Å—è –∑–∞–∫–ª–∞–¥–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ (–æ–∂–∏–¥–∞–µ–º–æ)

‚úì –¢–µ—Å—Ç 5: –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–ª–∞–¥–∫–∏
  –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ó–∞–∫–ª–∞–¥–∫–∞ —É–¥–∞–ª–µ–Ω–∞

‚úì –¢–µ—Å—Ç 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–∫–ª–∞–¥–∫–∏
  –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ó–∞–∫–ª–∞–¥–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª–µ–Ω–∞

–í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!
```

### –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```python
import unittest
from modules.bookmarks import BookmarkManager
from pathlib import Path

class TestBookmarks(unittest.TestCase):
    def setUp(self):
        """–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∫–∞–∂–¥–æ–º—É —Ç–µ—Å—Ç—É"""
        self.test_db = Path(__file__).parent / 'test.db'
        self.manager = BookmarkManager(str(self.test_db))
    
    def tearDown(self):
        """–û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞"""
        if self.test_db.exists():
            self.test_db.unlink()
    
    def test_add_bookmark(self):
        """–¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–ª–∞–¥–∫–∏"""
        result = self.manager.add_bookmark(
            user_id=123, chat_id=-100, message_id=1,
            message_text="Test", author_id=456, author_name="@user"
        )
        self.assertTrue(result)
    
    def test_duplicate_prevention(self):
        """–¢–µ—Å—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤"""
        self.manager.add_bookmark(123, -100, 1, "Test", 456, "@user")
        result = self.manager.add_bookmark(123, -100, 1, "Test2", 456, "@user")
        self.assertFalse(result)

if __name__ == '__main__':
    unittest.main()
```

---

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –ò–¥–µ—è 1: –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–∫–ª–∞–¥–æ–∫

```python
# –î–æ–±–∞–≤—å—Ç–µ –∫–æ–ª–æ–Ω–∫—É category –≤ —Ç–∞–±–ª–∏—Ü—É
ALTER TABLE bookmarks ADD COLUMN category TEXT DEFAULT 'general';

# –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
def get_bookmarks_by_category(self, user_id, category):
    conn = sqlite3.connect(self.db_path, check_same_thread=False)
    cursor = conn.cursor()
    cursor.execute(
        "SELECT * FROM bookmarks WHERE user_id = ? AND category = ? ORDER BY created_at DESC",
        (user_id, category)
    )
    result = cursor.fetchall()
    conn.close()
    return result
```

### –ò–¥–µ—è 2: –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É

```python
def search(self, user_id, query):
    """–ü–æ–∏—Å–∫ –∑–∞–∫–ª–∞–¥–æ–∫ –ø–æ —Ç–µ–∫—Å—Ç—É —Å–æ–æ–±—â–µ–Ω–∏—è"""
    conn = sqlite3.connect(self.db_path, check_same_thread=False)
    cursor = conn.cursor()
    cursor.execute(
        "SELECT * FROM bookmarks WHERE user_id = ? AND message_text LIKE ? ORDER BY created_at DESC",
        (user_id, f"%{query}%")
    )
    result = cursor.fetchall()
    conn.close()
    return result
```

### –ò–¥–µ—è 3: –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–∫–ª–∞–¥–æ–∫

```python
def export_to_file(self, user_id, format='txt'):
    """–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∑–∞–∫–ª–∞–¥–∫–∏ –≤ —Ñ–∞–π–ª"""
    bookmarks = self.get_user_bookmarks(user_id)
    
    if format == 'txt':
        content = "–ú–û–ò –ó–ê–ö–õ–ê–î–ö–ò\n" + "="*50 + "\n\n"
        for bm in bookmarks:
            content += f"- {bm[4]}\n  –ê–≤—Ç–æ—Ä: {bm[6]}\n  –î–∞—Ç–∞: {bm[7]}\n\n"
    elif format == 'json':
        content = json.dumps([{
            'text': bm[4],
            'author': bm[6],
            'date': bm[7]
        } for bm in bookmarks])
    
    return content
```

### –ò–¥–µ—è 4: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```python
def get_stats(self, user_id):
    """–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∑–∞–∫–ª–∞–¥–∫–∞–º"""
    conn = sqlite3.connect(self.db_path, check_same_thread=False)
    cursor = conn.cursor()
    
    # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
    cursor.execute("SELECT COUNT(*) FROM bookmarks WHERE user_id = ?", (user_id,))
    total = cursor.fetchone()[0]
    
    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ –∞–≤—Ç–æ—Ä–∞–º
    cursor.execute(
        "SELECT author_name, COUNT(*) FROM bookmarks WHERE user_id = ? GROUP BY author_name",
        (user_id,)
    )
    by_author = cursor.fetchall()
    
    conn.close()
    
    return {
        'total': total,
        'by_author': by_author
    }
```

---

## ‚öôÔ∏è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

- **–ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `user_id` –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω (PRIMARY KEY)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:** –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π
- **–ú–∏–Ω–∏–º—É–º –æ–ø–µ—Ä–∞—Ü–∏–π:** –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –æ–ø—Ç–∏–º–∞–ª–µ–Ω
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

### –ë–µ–Ω—á–º–∞—Ä–∫–∏

```
Operation           | Quantity | Time (ms)
add_bookmark()      | 10,000   | 150
get_user_bookmarks()| 1,000    | 20
remove_bookmark()   | 10,000   | 130
is_bookmarked()     | 100,000  | 250
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

```python
# ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ
cursor.execute("SELECT * FROM bookmarks WHERE user_id = ?", (user_id,))

# ‚ùå –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ!
cursor.execute(f"SELECT * FROM bookmarks WHERE user_id = {user_id}")
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

```python
# –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–∫–ª–∞–¥–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤–ª–∞–¥–µ–ª–µ—Ü
def remove_bookmark(self, user_id, chat_id, message_id):
    """–ú–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∑–∞–∫–ª–∞–¥–∫–∏"""
    # ...
```

### –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–∫–ª–∞–¥–∫–∏
- `UNIQUE(user_id, chat_id, message_id)` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å

---

## üìö –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **aiogram** 2.25.2+ - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram API
- **sqlite3** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å Python –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "database is locked"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –ë–î –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ  
**–†–µ—à–µ–Ω–∏–µ:** `check_same_thread=False` —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –∫–æ–¥–µ

```python
connection = sqlite3.connect(self.db_path, check_same_thread=False)
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Duplicate entry" –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏

**–ü—Ä–∏—á–∏–Ω–∞:** –°–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `is_bookmarked()` –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ `False` –∏–∑ `add_bookmark()`

### –ü—Ä–æ–±–ª–µ–º–∞: –§–æ—Ä–≤–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –°–æ–æ–±—â–µ–Ω–∏–µ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ –∏–ª–∏ –±–æ—Ç –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞  
**–†–µ—à–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –æ—à–∏–±–∫—É –≤ `go_to_bookmark_handler()`

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–ß–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ WERTY | Chat-Manager Bot

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ:** GitHub Copilot  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 20.12.2025
