# üé≤ –ú–æ–¥—É–ª—å Cubes (–î—É—ç–ª—å –Ω–∞ –∫—É–±–∏–∫–∞—Ö) - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 20.12.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production  
**–Ø–∑—ã–∫:** Python 3.10+  

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [API —Å–∏—Å—Ç–µ–º—ã –¥—É—ç–ª–µ–π](#api-—Å–∏—Å—Ç–µ–º—ã-–¥—É—ç–ª–µ–π)
4. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
5. [–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π](#–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏-—Å–æ–æ–±—â–µ–Ω–∏–π)
6. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
7. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
8. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
9. [–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏](#—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)

---

## üìñ –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å Cubes (`modules/cubes.py`) —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –¥—É—ç–ª–µ–π –º–µ–∂–¥—É –¥–≤—É–º—è –∏–≥—Ä–æ–∫–∞–º–∏ –Ω–∞ –∫—É–±–∏–∫–∞—Ö. –û–¥–∏–Ω –∏–≥—Ä–æ–∫ –≤—ã–∑—ã–≤–∞–µ—Ç –¥—Ä—É–≥–æ–≥–æ –Ω–∞ –¥—É—ç–ª—å, –≤—ã–∑–≤–∞–Ω–Ω—ã–π –º–æ–∂–µ—Ç —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è –∏–ª–∏ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è, –∞ –∑–∞—Ç–µ–º –∫—É–±–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ç–∞–≤–∫–∏ –Ω–∞ –∫–æ–∏–Ω—ã –∏–∑ —Ñ–∞—Ä–º—ã.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ **–°–∏—Å—Ç–µ–º–∞ –≤—ã–∑–æ–≤–æ–≤** - –æ–¥–∏–Ω –∏–≥—Ä–æ–∫ –≤—ã–∑—ã–≤–∞–µ—Ç –¥—Ä—É–≥–æ–≥–æ –Ω–∞ –¥—É—ç–ª—å  
‚úÖ **–í—Ä–µ–º—è –Ω–∞ –æ—Ç–≤–µ—Ç** - 90 —Å–µ–∫—É–Ω–¥ —á—Ç–æ–±—ã —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è –∏–ª–∏ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è  
‚úÖ **–°—Ç–∞–≤–∫–∏** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–≥—Ä–∞—Ç—å –Ω–∞ –∫–æ–∏–Ω—ã –∏–∑ –º–µ—à–∫–∞  
‚úÖ **–ë—Ä–æ—Å–∫–∏ –∫—É–±–∏–∫–æ–≤** - —Å–ª—É—á–∞–π–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞  
‚úÖ **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º  
‚úÖ **–ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–∏–Ω–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ –≤—ã–∏–≥—Ä—ã—à–∞/–ø—Ä–æ–∏–≥—Ä—ã—à–∞  
‚úÖ **–ò—Å—Ç–æ—Ä–∏—è –¥—É—ç–ª–µ–π** - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤  

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
modules/cubes.py
‚îú‚îÄ‚îÄ –ö–ª–∞—Å—Å _CubesDuel
‚îÇ   ‚îú‚îÄ‚îÄ duel_id: str
‚îÇ   ‚îú‚îÄ‚îÄ chat_id: int
‚îÇ   ‚îú‚îÄ‚îÄ inviter_id: int
‚îÇ   ‚îú‚îÄ‚îÄ opponent_id: int
‚îÇ   ‚îú‚îÄ‚îÄ inviter_name: str
‚îÇ   ‚îú‚îÄ‚îÄ opponent_name: str
‚îÇ   ‚îú‚îÄ‚îÄ invite_message_id: int
‚îÇ   ‚îú‚îÄ‚îÄ created_at: float
‚îÇ   ‚îî‚îÄ‚îÄ stake: int
‚îÇ
‚îú‚îÄ‚îÄ –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥—É—ç–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ _PENDING_BY_CHAT[chat_id] -> duel_id
‚îÇ   ‚îî‚îÄ‚îÄ _PENDING_BY_ID[duel_id] -> _CubesDuel
‚îÇ
‚îú‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ cubes_handler() - –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –¥—É—ç–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ accept_duel_handler() - —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è —Å –¥—É—ç–ª—å—é
‚îÇ   ‚îú‚îÄ‚îÄ reject_duel_handler() - –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –¥—É—ç–ª—å
‚îÇ   ‚îî‚îÄ‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç—ë–∫—à–∏—Ö –¥—É—ç–ª–µ–π
‚îÇ
‚îî‚îÄ‚îÄ –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    ‚îú‚îÄ‚îÄ _user_link() - —Å–æ–∑–¥–∞–Ω–∏–µ HTML-—Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ‚îú‚îÄ‚îÄ _is_expired() - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –¥—É—ç–ª–∏
    ‚îú‚îÄ‚îÄ _parse_stake() - –ø–∞—Ä—Å–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç–∞–≤–∫–∏
    ‚îî‚îÄ‚îÄ _ensure_farma_row_and_get_meshok() - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
–ò–≥—Ä–æ–∫ A –ø–∏—à–µ—Ç "!–∫—É–±—ã 100" –¥–ª—è –≤—ã–∑–æ–≤–∞ B
         ‚Üì
    cubes_handler()
         ‚Üì
    –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ _CubesDuel
         ‚Üì
    –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ _PENDING_BY_ID –∏ _PENDING_BY_CHAT
         ‚Üì
    –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–Ω–æ–ø–∫–∞–º–∏ —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è/–æ—Ç–∫–∞–∑–∞—Ç—å—Å—è
         ‚Üì
    90 —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏—è –Ω–∞ –æ—Ç–≤–µ—Ç
         ‚Üì
    [–ò–≥—Ä–æ–∫ B —Å–æ–≥–ª–∞—Å–∏–ª—Å—è] –ò–õ–ò [–í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ]
         ‚Üì
    –†–æ–∑—ã–≥—Ä—ã—à –∫—É–±–∏–∫–æ–≤
         ‚Üì
    –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
         ‚Üì
    –ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–∏–Ω–æ–≤
         ‚Üì
    –£–¥–∞–ª–µ–Ω–∏–µ –¥—É—ç–ª–∏ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
```

---

## üîå API —Å–∏—Å—Ç–µ–º—ã –¥—É—ç–ª–µ–π

### _CubesDuel

–ö–ª–∞—Å—Å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥—É—ç–ª–∏.

```python
@dataclass
class _CubesDuel:
    duel_id: str              # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥—É—ç–ª–∏
    chat_id: int              # ID —á–∞—Ç–∞, –≥–¥–µ –∏–¥—ë—Ç –¥—É—ç–ª—å
    inviter_id: int           # ID –ø—Ä–∏–≥–ª–∞—à–∞—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
    opponent_id: int          # ID –≤—ã–∑–≤–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
    inviter_name: str         # –ò–º—è –ø—Ä–∏–≥–ª–∞—à–∞—é—â–µ–≥–æ
    opponent_name: str        # –ò–º—è –≤—ã–∑–≤–∞–Ω–Ω–æ–≥–æ
    invite_message_id: int    # ID —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ–º
    created_at: float         # –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è)
    stake: int                # –°—Ç–∞–≤–∫–∞ –≤ –∫–æ–∏–Ω–∞—Ö
```

### _PENDING_BY_CHAT –∏ _PENDING_BY_ID

–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥—É—ç–ª–µ–π.

```python
_PENDING_BY_CHAT: dict[int, str] = {}  # chat_id -> duel_id
_PENDING_BY_ID: dict[str, _CubesDuel] = {}  # duel_id -> _CubesDuel
```

### _parse_stake()

–§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç–∞–≤–∫–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∫–æ–º–∞–Ω–¥—ã.

```python
def _parse_stake(text: str) -> Optional[int]:
    """
    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
      - "!–∫—É–±—ã 100"
      - "! –∫—É–±—ã 100"
      - –±–µ–∑ —Å—Ç–∞–≤–∫–∏ -> 100 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    """
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `text` (str): –¢–µ–∫—Å—Ç –∫–æ–º–∞–Ω–¥—ã

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** 
- `int` - —Ä–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100)
- `None` - –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π

**–ü—Ä–∏–º–µ—Ä—ã:**
```python
_parse_stake("!–∫—É–±—ã 100")     # -> 100
_parse_stake("! –∫—É–±—ã 50")     # -> 50
_parse_stake("!–∫—É–±—ã")         # -> 100 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
_parse_stake("!–∫—É–±—ã abc")     # -> None
```

### _ensure_farma_row_and_get_meshok()

–§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–∞–ø–∏—Å–∏.

```python
def _ensure_farma_row_and_get_meshok(cursor: sqlite3.Cursor, user_id: int) -> int:
    """
    –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ farma –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∞–ª–∞–Ω—Å
    """
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `cursor` (sqlite3.Cursor): –ö—É—Ä—Å–æ—Ä –ë–î
- `user_id` (int): ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** 
- `int` - —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –º–µ—à–∫–∞ (–∏–ª–∏ 0 –µ—Å–ª–∏ –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

### cubes_handler()

–û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∏—è –¥—É—ç–ª–∏.

```python
@dp.message_handler(Text(startswith=['! –∫—É–±—ã', '!–∫—É–±—ã'], ignore_case=True))
async def cubes_handler(message: types.Message):
    """
    –ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –¥—É—ç–ª—å –º–µ–∂–¥—É –¥–≤—É–º—è –∏–≥—Ä–æ–∫–∞–º–∏ –Ω–∞ –∫—É–±–∏–∫–∞—Ö
    """
```

**–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—à–µ—Ç `!–∫—É–±—ã` –∏–ª–∏ `! –∫—É–±—ã` —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å—Ç–∞–≤–∫–æ–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `message.from_user.id` (int): ID –ø—Ä–∏–≥–ª–∞—à–∞—é—â–µ–≥–æ
- `message.reply_to_message` (optional): –ï—Å–ª–∏ –¥—É—ç–ª—å –ø–æ –æ—Ç–≤–µ—Ç—É –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
- `message.text` (str): –¢–µ–∫—Å—Ç –∫–æ–º–∞–Ω–¥—ã, —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç)

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–∞–µ—Ç —Ü–µ–ª–µ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (–∏–∑ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ)
2. –ü–∞—Ä—Å–∏—Ç —Ä–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å –æ–±–æ–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
4. –°–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç _CubesDuel
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è/–æ—Ç–∫–∞–∑–∞—Ç—å—Å—è
6. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–∞–π–º–µ—Ä –Ω–∞ 90 —Å–µ–∫—É–Ω–¥
7. –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —É–¥–∞–ª—è–µ—Ç –¥—É—ç–ª—å

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `farma`

```sql
CREATE TABLE IF NOT EXISTS farma (
    user_id INTEGER PRIMARY KEY,
    meshok INTEGER DEFAULT 0,
    last_date TEXT
)
```

### –¢–∞–±–ª–∏—Ü–∞ `duels` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏)

```sql
CREATE TABLE IF NOT EXISTS duels (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    chat_id INTEGER NOT NULL,
    inviter_id INTEGER NOT NULL,
    opponent_id INTEGER NOT NULL,
    winner_id INTEGER NOT NULL,
    stake INTEGER NOT NULL,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
```

### –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –î—É—ç–ª—å —Å —Å—Ç–∞–≤–∫–æ–π 100 –∫–æ–∏–Ω–æ–≤
INSERT INTO duels (chat_id, inviter_id, opponent_id, winner_id, stake)
VALUES (-1001234567890, 111111, 222222, 111111, 100);

-- –î—É—ç–ª—å —Å —Å—Ç–∞–≤–∫–æ–π 50 –∫–æ–∏–Ω–æ–≤
INSERT INTO duels (chat_id, inviter_id, opponent_id, winner_id, stake)
VALUES (-1001234567890, 333333, 444444, 444444, 50);
```

---

## üéØ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

### cubes_handler()

**–û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∏—è –¥—É—ç–ª–∏.**

```python
@dp.message_handler(Text(startswith=['! –∫—É–±—ã', '!–∫—É–±—ã'], ignore_case=True))
async def cubes_handler(message: types.Message):
    """
    –ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –¥—É—ç–ª—å –º–µ–∂–¥—É –ø—Ä–∏–≥–ª–∞—à–∞—é—â–∏–º –∏ –≤—ã–∑–≤–∞–Ω–Ω—ã–º –∏–≥—Ä–æ–∫–æ–º
    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ç–∞–≤–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –±–∞–ª–∞–Ω—Å–∞
    """
```

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –¥—É—ç–ª—å –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∞ –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –ü–æ–ª—É—á–∞–µ—Ç —Ü–µ–ª–µ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
3. –ü–∞—Ä—Å–∏—Ç —Ä–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∫–æ–º–∞–Ω–¥—ã
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å –æ–±–æ–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
5. –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –¥—É—ç–ª—å
6. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
7. –ñ–¥—ë—Ç 90 —Å–µ–∫—É–Ω–¥ –Ω–∞ –æ—Ç–≤–µ—Ç

### accept_duel_handler()

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–æ–≥–ª–∞—Å–∏—è —Å –¥—É—ç–ª—å—é.**

```python
@dp.callback_query_handler(lambda call: call.data.startswith('duel_accept_'))
async def accept_duel_handler(call: types.CallbackQuery):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–°–æ–≥–ª–∞—Å–∏—Ç—å—Å—è"
    –ü—Ä–æ–≤–æ–¥–∏—Ç —Ä–æ–∑—ã–≥—Ä—ã—à –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
    """
```

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü–æ–ª—É—á–∞–µ—Ç ID –¥—É—ç–ª–∏ –∏–∑ callback data
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –∏—Å—Ç–µ–∫–ª–∞ –ª–∏ –¥—É—ç–ª—å
3. –ü—Ä–æ–≤–æ–¥–∏—Ç –±—Ä–æ—Å–∫–∏ –∫—É–±–∏–∫–æ–≤ –¥–ª—è –æ–±–æ–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
4. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è (–±–æ–ª—å—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
5. –ü–µ—Ä–µ–¥–∞—ë—Ç –∫–æ–∏–Ω—ã –æ—Ç –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–≥–æ –∫ –ø–æ–±–µ–¥–∏—Ç–µ–ª—é
6. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
7. –£–¥–∞–ª—è–µ—Ç –¥—É—ç–ª—å –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

### reject_duel_handler()

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –¥—É—ç–ª–∏.**

```python
@dp.callback_query_handler(lambda call: call.data.startswith('duel_reject_'))
async def reject_duel_handler(call: types.CallbackQuery):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–û—Ç–∫–∞–∑–∞—Ç—å—Å—è"
    """
```

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –£–¥–∞–ª—è–µ—Ç –¥—É—ç–ª—å –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç–∫–∞–∑–µ
3. –£–≤–µ–¥–æ–º–ª—è–µ—Ç –ø—Ä–∏–≥–ª–∞—à–∞—é—â–µ–≥–æ –æ–± –æ—Ç–∫–∞–∑–µ

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∏–µ –¥—É—ç–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ

```python
import asyncio
from dataclasses import dataclass
import time

@dataclass
class _CubesDuel:
    duel_id: str
    chat_id: int
    inviter_id: int
    opponent_id: int
    inviter_name: str
    opponent_name: str
    invite_message_id: int
    created_at: float
    stake: int

async def initiate_duel(inviter_id: int, opponent_id: int, chat_id: int, stake: int = 100):
    """–ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –¥—É—ç–ª—å –º–µ–∂–¥—É –¥–≤—É–º—è –∏–≥—Ä–æ–∫–∞–º–∏"""
    import secrets
    
    duel_id = secrets.token_hex(4)
    
    duel = _CubesDuel(
        duel_id=duel_id,
        chat_id=chat_id,
        inviter_id=inviter_id,
        opponent_id=opponent_id,
        inviter_name="Player1",
        opponent_name="Player2",
        invite_message_id=0,
        created_at=time.monotonic(),
        stake=stake
    )
    
    return duel
```

### –ü—Ä–∏–º–µ—Ä 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–æ–≤ –¥–ª—è –¥—É—ç–ª–∏

```python
def can_both_afford_duel(inviter_id: int, opponent_id: int, stake: int, db_path: str) -> tuple[bool, str]:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–≥—É—Ç –ª–∏ –æ–±–∞ –∏–≥—Ä–æ–∫–∞ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –¥—É—ç–ª–∏"""
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å –ø—Ä–∏–≥–ª–∞—à–∞—é—â–µ–≥–æ
    inviter_balance = cursor.execute(
        "SELECT meshok FROM farma WHERE user_id = ?", 
        (inviter_id,)
    ).fetchone()
    inviter_balance = inviter_balance[0] if inviter_balance else 0
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å –≤—ã–∑–≤–∞–Ω–Ω–æ–≥–æ
    opponent_balance = cursor.execute(
        "SELECT meshok FROM farma WHERE user_id = ?", 
        (opponent_id,)
    ).fetchone()
    opponent_balance = opponent_balance[0] if opponent_balance else 0
    
    connection.close()
    
    if inviter_balance < stake:
        return False, f"–£ –ø—Ä–∏–≥–ª–∞—à–∞—é—â–µ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤ ({inviter_balance}/{stake})"
    
    if opponent_balance < stake:
        return False, f"–£ –≤—ã–∑–≤–∞–Ω–Ω–æ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤ ({opponent_balance}/{stake})"
    
    return True, "–û–±–∞ –∏–≥—Ä–æ–∫–∞ –º–æ–≥—É—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å"

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
can_afford, message = can_both_afford_duel(123456, 234567, 100, "Base_bot.db")
if can_afford:
    print("–î—É—ç–ª—å –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å—Å—è")
else:
    print(f"–û—à–∏–±–∫–∞: {message}")
```

### –ü—Ä–∏–º–µ—Ä 3: –ë—Ä–æ—Å–∫–∏ –∫—É–±–∏–∫–æ–≤ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è

```python
import random

def roll_dice() -> int:
    """–ë—Ä–æ—Å–∞–µ—Ç –æ–¥–∏–Ω –∫—É–±–∏–∫ (–æ—Ç 1 –¥–æ 6)"""
    return random.randint(1, 6)

def conduct_duel(inviter_name: str, opponent_name: str, stake: int) -> dict:
    """–ü—Ä–æ–≤–æ–¥–∏—Ç –¥—É—ç–ª—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"""
    # –û–±–∞ –∏–≥—Ä–æ–∫–∞ –±—Ä–æ—Å–∞—é—Ç 3 –∫—É–±–∏–∫–∞ –∫–∞–∂–¥—ã–π
    inviter_rolls = [roll_dice() for _ in range(3)]
    opponent_rolls = [roll_dice() for _ in range(3)]
    
    inviter_score = sum(inviter_rolls)
    opponent_score = sum(opponent_rolls)
    
    if inviter_score > opponent_score:
        winner = inviter_name
        loser = opponent_name
    elif opponent_score > inviter_score:
        winner = opponent_name
        loser = inviter_name
    else:
        winner = "–ù–∏—á—å—è"
        loser = None
    
    return {
        "inviter_name": inviter_name,
        "opponent_name": opponent_name,
        "inviter_rolls": inviter_rolls,
        "opponent_rolls": opponent_rolls,
        "inviter_score": inviter_score,
        "opponent_score": opponent_score,
        "winner": winner,
        "stake": stake
    }

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
result = conduct_duel("–ò–≤–∞–Ω", "–ú–∞—Ä–∏—è", 100)
print(f"{result['inviter_name']}: {result['inviter_rolls']} = {result['inviter_score']}")
print(f"{result['opponent_name']}: {result['opponent_rolls']} = {result['opponent_score']}")
print(f"–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: {result['winner']}")
```

### –ü—Ä–∏–º–µ—Ä 4: –ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–∏–Ω–æ–≤ –ø–æ—Å–ª–µ –¥—É—ç–ª–∏

```python
def transfer_coins(from_user: int, to_user: int, amount: int, db_path: str) -> bool:
    """–ü–µ—Ä–µ–¥–∞—ë—Ç –∫–æ–∏–Ω—ã –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥—Ä—É–≥–æ–º—É"""
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()
    
    try:
        # –í—ã—á–∏—Ç–∞–µ–º —É –ø–µ—Ä–≤–æ–≥–æ
        from_balance = cursor.execute(
            "SELECT meshok FROM farma WHERE user_id = ?",
            (from_user,)
        ).fetchone()
        
        if from_balance is None or from_balance[0] < amount:
            return False
        
        new_from_balance = from_balance[0] - amount
        cursor.execute(
            "UPDATE farma SET meshok = ? WHERE user_id = ?",
            (new_from_balance, from_user)
        )
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–º—É
        to_balance = cursor.execute(
            "SELECT meshok FROM farma WHERE user_id = ?",
            (to_user,)
        ).fetchone()
        
        new_to_balance = (to_balance[0] if to_balance else 0) + amount
        
        if to_balance is None:
            cursor.execute(
                "INSERT INTO farma (user_id, meshok, last_date) VALUES (?, ?, ?)",
                (to_user, new_to_balance, datetime.now().strftime("%H:%M:%S %d.%m.%Y"))
            )
        else:
            cursor.execute(
                "UPDATE farma SET meshok = ? WHERE user_id = ?",
                (new_to_balance, to_user)
            )
        
        connection.commit()
        return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –∫–æ–∏–Ω–æ–≤: {e}")
        return False
    finally:
        connection.close()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
if transfer_coins(123456, 234567, 100, "Base_bot.db"):
    print("‚úÖ 100 –∫–æ–∏–Ω–æ–≤ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω—ã")
else:
    print("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –∫–æ–∏–Ω–æ–≤")
```

### –ü—Ä–∏–º–µ—Ä 5: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥—É—ç–ª–∏

```python
def save_duel_result(chat_id: int, inviter_id: int, opponent_id: int, 
                     winner_id: int, stake: int, db_path: str) -> bool:
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥—É—ç–ª–∏ –≤ –ë–î –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏"""
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()
    
    try:
        # –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS duels (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                chat_id INTEGER NOT NULL,
                inviter_id INTEGER NOT NULL,
                opponent_id INTEGER NOT NULL,
                winner_id INTEGER NOT NULL,
                stake INTEGER NOT NULL,
                timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        ''')
        
        cursor.execute(
            '''INSERT INTO duels (chat_id, inviter_id, opponent_id, winner_id, stake)
               VALUES (?, ?, ?, ?, ?)''',
            (chat_id, inviter_id, opponent_id, winner_id, stake)
        )
        
        connection.commit()
        return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥—É—ç–ª–∏: {e}")
        return False
    finally:
        connection.close()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
save_duel_result(
    chat_id=-1001234567890,
    inviter_id=123456,
    opponent_id=234567,
    winner_id=123456,
    stake=100,
    db_path="Base_bot.db"
)
```

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ main_bot.py

```python
# main/main_bot.py

import modules.cubes  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

# –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞...

if __name__ == '__main__':
    print("Starting bot...")
    dp.start_polling()
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–æ–¥—É–ª–µ–º Farm

```python
# –°–∏—Å—Ç–µ–º–∞ –¥—É—ç–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–∏–Ω—ã –∏–∑ –º–æ–¥—É–ª—è farm
# –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –¥—É—ç–ª–∏:
# 1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –±–∞–ª–∞–Ω—Å –≤ —Ç–∞–±–ª–∏—Ü–µ farma
# 2. –í—ã—á–∏—Ç–∞—é—Ç—Å—è –∫–æ–∏–Ω—ã —Å–æ —Å—Ç–∞–≤–∫–æ–π
# 3. –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫–æ–∏–Ω—ã –ø–æ–±–µ–¥–∏—Ç–µ–ª—é
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
python test_cubes.py
```

### –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

```python
import unittest
import sqlite3
from datetime import datetime
from pathlib import Path

class TestCubes(unittest.TestCase):
    def setUp(self):
        """–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∫–∞–∂–¥–æ–º—É —Ç–µ—Å—Ç—É"""
        self.test_db = Path(__file__).parent / 'test_cubes.db'
        self.connection = sqlite3.connect(str(self.test_db), check_same_thread=False)
        self.cursor = self.connection.cursor()
        self._create_tables()
    
    def tearDown(self):
        """–û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞"""
        self.connection.close()
        if self.test_db.exists():
            self.test_db.unlink()
    
    def _create_tables(self):
        """–°–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã"""
        self.cursor.execute('''
            CREATE TABLE IF NOT EXISTS farma (
                user_id INTEGER PRIMARY KEY,
                meshok INTEGER DEFAULT 0,
                last_date TEXT
            )
        ''')
        self.cursor.execute('''
            CREATE TABLE IF NOT EXISTS duels (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                chat_id INTEGER,
                inviter_id INTEGER,
                opponent_id INTEGER,
                winner_id INTEGER,
                stake INTEGER,
                timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        ''')
        self.connection.commit()
    
    def test_duel_requires_sufficient_balance(self):
        """–¢–µ—Å—Ç: –¥—É—ç–ª—å —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞"""
        # –ü–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫ —Å 50 –∫–æ–∏–Ω–∞–º–∏
        self.cursor.execute(
            "INSERT INTO farma (user_id, meshok, last_date) VALUES (?, ?, ?)",
            (123456, 50, datetime.now().strftime("%H:%M:%S %d.%m.%Y"))
        )
        
        # –í—Ç–æ—Ä–æ–π –∏–≥—Ä–æ–∫ —Å 200 –∫–æ–∏–Ω–∞–º–∏
        self.cursor.execute(
            "INSERT INTO farma (user_id, meshok, last_date) VALUES (?, ?, ?)",
            (234567, 200, datetime.now().strftime("%H:%M:%S %d.%m.%Y"))
        )
        self.connection.commit()
        
        # –ü–µ—Ä–≤—ã–π –Ω–µ –º–æ–∂–µ—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –¥—É—ç–ª–∏ –Ω–∞ 100 –∫–æ–∏–Ω–æ–≤
        balance1 = self.cursor.execute(
            "SELECT meshok FROM farma WHERE user_id = ?",
            (123456,)
        ).fetchone()[0]
        
        stake = 100
        self.assertLess(balance1, stake)

if __name__ == '__main__':
    unittest.main()
```

---

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –ò–¥–µ—è 1: –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –¥—É—ç–ª–µ–π

```python
DUEL_TYPES = {
    "—Å—Ç–∞–Ω–¥–∞—Ä—Ç": {"dice_count": 3, "name": "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥—É—ç–ª—å"},
    "—ç–∫—Å—Ç—Ä–∏–º": {"dice_count": 5, "name": "–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –¥—É—ç–ª—å"},
    "–±—ã—Å—Ç—Ä–∞—è": {"dice_count": 1, "name": "–ë—ã—Å—Ç—Ä–∞—è –¥—É—ç–ª—å"}
}

def get_duel_type_info(duel_type: str) -> dict:
    """–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–µ –¥—É—ç–ª–∏"""
    return DUEL_TYPES.get(duel_type, DUEL_TYPES["—Å—Ç–∞–Ω–¥–∞—Ä—Ç"])
```

### –ò–¥–µ—è 2: –†–µ–π—Ç–∏–Ω–≥ –¥—É—ç–ª–∏—Å—Ç–æ–≤

```python
def get_duel_stats(user_id: int, db_path: str) -> dict:
    """–ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –¥—É—ç–ª—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()
    
    # –í—Å–µ–≥–æ –¥—É—ç–ª–µ–π
    total = cursor.execute(
        "SELECT COUNT(*) FROM duels WHERE inviter_id = ? OR opponent_id = ?",
        (user_id, user_id)
    ).fetchone()[0]
    
    # –ü–æ–±–µ–¥
    wins = cursor.execute(
        "SELECT COUNT(*) FROM duels WHERE winner_id = ?",
        (user_id,)
    ).fetchone()[0]
    
    # –ü—Ä–æ–∏–≥—Ä—ã—à–µ–π
    losses = total - wins
    
    # –í—ã–∏–≥—Ä–∞–Ω–Ω—ã—Ö –∫–æ–∏–Ω–æ–≤
    earned = cursor.execute(
        "SELECT SUM(stake) FROM duels WHERE winner_id = ?",
        (user_id,)
    ).fetchone()[0] or 0
    
    connection.close()
    
    return {
        "total_duels": total,
        "wins": wins,
        "losses": losses,
        "win_rate": (wins / total * 100) if total > 0 else 0,
        "earned_coins": earned
    }
```

### –ò–¥–µ—è 3: –°–µ–∑–æ–Ω–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã –¥—É—ç–ª–µ–π

```python
def get_season_stats(user_id: int, season: str, db_path: str) -> dict:
    """–ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ —Å–µ–∑–æ–Ω"""
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()
    
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—ã —Å–µ–∑–æ–Ω–∞
    season_dates = {
        "S1_2025": ("2025-01-01", "2025-03-31"),
        "S2_2025": ("2025-04-01", "2025-06-30"),
        "S3_2025": ("2025-07-01", "2025-09-30"),
        "S4_2025": ("2025-10-01", "2025-12-31"),
    }
    
    if season not in season_dates:
        return {}
    
    start_date, end_date = season_dates[season]
    
    wins = cursor.execute(
        "SELECT COUNT(*) FROM duels WHERE winner_id = ? AND timestamp BETWEEN ? AND ?",
        (user_id, start_date, end_date)
    ).fetchone()[0]
    
    connection.close()
    return {"season": season, "wins": wins}
```

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–ß–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ WERTY | Chat-Manager Bot

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ:** GitHub Copilot  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 20.12.2025
