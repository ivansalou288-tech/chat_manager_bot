# üìå –ú–æ–¥—É–ª—å Farm (–§–µ—Ä–º–∞) - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 20.12.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production  
**–Ø–∑—ã–∫:** Python 3.10+  

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [API –∫–ª–∞—Å—Å–∞ FarmManager](#api-–∫–ª–∞—Å—Å–∞-farmmanager)
4. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
5. [–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π](#–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏-—Å–æ–æ–±—â–µ–Ω–∏–π)
6. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
7. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
8. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
9. [–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏](#—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)

---

## üìñ –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å —Ñ–µ—Ä–º–∞ (`modules/farm.py`) –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤—É—é –≤–∞–ª—é—Ç—É **eZ¬¢** (–∫–æ–∏–Ω—ã) —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ñ–µ—Ä–º–µ. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ –≤ 4 —á–∞—Å–∞ –∏ –ø–æ–ª—É—á–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç –æ—Ç 3 –¥–æ 150 eZ¬¢.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ **–ó–∞—Ä–∞–±–æ—Ç–æ–∫ –∫–æ–∏–Ω–æ–≤** - –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã `—Ñ–∞—Ä–º–∞` –∏–ª–∏ `—Ñ–µ—Ä–º–∞`  
‚úÖ **–ö—É–ª–¥–∞—É–Ω 4 —á–∞—Å–∞** - –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞, –æ–¥–Ω–∞ —Ä–∞–±–æ—Ç–∞ –≤ 4 —á–∞—Å–∞  
‚úÖ **–°–ª—É—á–∞–π–Ω—ã–π –¥–æ—Ö–æ–¥** - –æ—Ç 3 –¥–æ 150 eZ¬¢ –∑–∞ —Ä–∞–±–æ—Ç—É  
‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—à–∫–∞** - –∫–æ–∏–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `farma`  
‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç —á—ë—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞** - –∑–∞–±–∞–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å  
‚úÖ **–¢–∞–π–º–µ—Ä –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** - –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞—Å—á—ë—Ç –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏  

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
modules/farm.py
‚îú‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ farm()
‚îÇ   ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—ë—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–ª–¥–∞—É–Ω–∞ (4 —á–∞—Å–∞)
‚îÇ   ‚îú‚îÄ‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —á–∏—Å–ª–∞ (3-150)
‚îÇ   ‚îú‚îÄ‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É farma
‚îÇ   ‚îî‚îÄ‚îÄ –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
‚îÇ
‚îú‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ mesh()
‚îÇ   ‚îú‚îÄ‚îÄ –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –º–µ—à–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ –ü–æ–∏—Å–∫ –ø–æ —é–∑–µ—Ä–Ω–µ–π–º—É, @—É–ø–æ–º–∏–Ω–∞–Ω–∏—é –∏–ª–∏ –æ—Ç–≤–µ—Ç—É
‚îÇ   ‚îî‚îÄ‚îÄ –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–∏–Ω–∞—Ö
‚îÇ
‚îú‚îÄ‚îÄ –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ –†–∞—Å—á—ë—Ç –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —Å–ª–µ–¥—É—é—â–µ–π —Ä–∞–±–æ—Ç—ã
‚îÇ
‚îî‚îÄ‚îÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –ë–î
    ‚îú‚îÄ‚îÄ farma (–æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–æ–∏–Ω–æ–≤)
    ‚îú‚îÄ‚îÄ black_list (—á—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫)
    ‚îî‚îÄ‚îÄ [chat_id] (—Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–∞—Ç–∞)
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç "—Ñ–∞—Ä–º–∞"
         ‚Üì
    farm_handler()
         ‚Üì
    –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—ë—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
         ‚Üì
    –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–ª–¥–∞—É–Ω–∞ (4 —á–∞—Å–∞)
         ‚Üì
    –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —á–∏—Å–ª–∞ (3-150)
         ‚Üì
    UPDATE/INSERT –≤ —Ç–∞–±–ª–∏—Ü—É farma
         ‚Üì
    ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∑–∞—Ä–∞–±–æ—Ç–∫–∞
```

---

## üîå API —Ñ—É–Ω–∫—Ü–∏–π

### farm()

–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ñ–µ—Ä–º–µ –∏ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–∏–Ω–æ–≤.

```python
@dp.message_handler(Text(startswith=['—Ñ–∞—Ä–º–∞', '—Ñ–µ—Ä–º–∞', '—Ä–∞–± —Ä–∞–± —Ä–∞–±–æ—Ç–∞—Ç—å'], ignore_case=True))
async def farm(message: types.Message):
    # –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ñ–µ—Ä–º–µ
```

**–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—à–µ—Ç `—Ñ–∞—Ä–º–∞`, `—Ñ–µ—Ä–º–∞` –∏–ª–∏ `—Ä–∞–± —Ä–∞–± —Ä–∞–±–æ—Ç–∞—Ç—å`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ message:**
- `message.from_user.id` (int): ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
- `message.chat.id` (int): ID —á–∞—Ç–∞
- `message.from_user.id` (int): ID –∞–≤—Ç–æ—Ä–∞ –∫–æ–º–∞–Ω–¥—ã

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –≤ —á–∞—Ç)

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –º–µ—à–∫–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `farma`
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—É–ª–¥–∞—É–Ω (4 —á–∞—Å–∞ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–∞–±–æ—Ç—ã)
3. –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ >= 4 —á–∞—Å–∞:
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç 3 –¥–æ 150
   - –î–æ–±–∞–≤–ª—è–µ—Ç —ç—Ç–æ —á–∏—Å–ª–æ –∫ –±–∞–ª–∞–Ω—Å—É –º–µ—à–∫–∞
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `last_date` –≤ –ë–î
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ‚úÖ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∫–æ–∏–Ω–æ–≤
4. –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ < 4 —á–∞—Å–æ–≤:
   - –í—ã—á–∏—Å–ª—è–µ—Ç –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ‚ùå —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è

**–û—Ç–≤–µ—Ç—ã –±–æ—Ç–∞:**
- ‚úÖ –£—Å–ø–µ—Ö: "‚úÖ **–ó–ê–ß–Å–¢!** üçä +{delta_bust} eZ¬¢"
- ‚ùå –ß—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫: "‚ùå**–ù–ï–ó–ê–ß–ï–¢!** –†–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —Ñ–µ—Ä–º–µ –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ..."
- ‚ùå –ö—É–ª–¥–∞—É–Ω: "‚ùå**–ù–ï–ó–ê–ß–ï–¢!** –§–∞—Ä–º–∏—Ç—å –º–æ–∂–Ω–æ —Ä–∞–∑ –≤ 4 —á–∞—Å–∞. –°–ª–µ–¥—É—é—â–∞—è –¥–æ–±—ã—á–∞ —á–µ—Ä–µ–∑ {–≤—Ä–µ–º—è}"

---

### mesh()

–§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –±–∞–ª–∞–Ω—Å–∞ –∫–æ–∏–Ω–æ–≤ –º–µ—à–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```python
@dp.message_handler(Text(startswith=['–º–µ—à–æ–∫'], ignore_case=True))
async def mesh(message: types.Message):
    # –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—à–∫–µ
```

**–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—à–µ—Ç `–º–µ—à–æ–∫`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –ü–æ @ —É–ø–æ–º–∏–Ω–∞–Ω–∏—é: `–º–µ—à–æ–∫ @username`
- –ü–æ –æ—Ç–≤–µ—Ç—É –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ: `–º–µ—à–æ–∫` (–æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ)
- –ü—Ä–æ —Å–µ–±—è: `–º–µ—à–æ–∫` (–±–µ–∑ –æ—Ç–≤–µ—Ç–∞ –∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —á–∞—Ç)

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ @, –æ—Ç–≤–µ—Ç–∞ –∏–ª–∏ —Å–∞–º–æ–≥–æ –∞–≤—Ç–æ—Ä–∞)
2. –ü–æ–ª—É—á–∞–µ—Ç —é–∑–µ—Ä–Ω–µ–π–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ò—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ —á–∞—Ç–∞
4. –ü–æ–ª—É—á–∞–µ—Ç –±–∞–ª–∞–Ω—Å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `farma`
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

**–û—Ç–≤–µ—Ç—ã –±–æ—Ç–∞:**
- ‚úÖ –£—Å–ø–µ—Ö: "üçä **{name_user}** –∏–º–µ–µ—Ç –≤ –º–µ—à–∫–µ **{meshok} eZ¬¢**"
- ‚ùå –û—à–∏–±–∫–∞: "üìù –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ..."

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `farma`

```sql
CREATE TABLE IF NOT EXISTS farma (
    user_id INTEGER PRIMARY KEY,
    meshok INTEGER DEFAULT 0,
    last_date TEXT
)
```

### –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫

| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|---------|
| `user_id` | INTEGER | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram (PRIMARY KEY) |
| `meshok` | INTEGER | –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∫–æ–∏–Ω–æ–≤ eZ¬¢ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0) |
| `last_date` | TEXT | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–∞–±–æ—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ "HH:MM:SS DD.MM.YYYY" |

### –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–∏–º–µ—Ä 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
INSERT INTO farma (user_id, meshok, last_date)
VALUES (123456, 50, "15:30:00 20.12.2025");

-- –ü—Ä–∏–º–µ—Ä 2: –û–ø—ã—Ç–Ω—ã–π —Ñ–∞—Ä–º–µ—Ä
INSERT INTO farma (user_id, meshok, last_date)
VALUES (234567, 1250, "14:15:00 20.12.2025");

-- –ü—Ä–∏–º–µ—Ä 3: –¢–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª
INSERT INTO farma (user_id, meshok, last_date)
VALUES (345678, 75, "19:45:00 20.12.2025");
```

---

## üéØ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

### farm()

**–û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ñ–µ—Ä–º–µ.**

```python
@dp.message_handler(Text(startswith=['—Ñ–∞—Ä–º–∞', '—Ñ–µ—Ä–º–∞', '—Ä–∞–± —Ä–∞–± —Ä–∞–±–æ—Ç–∞—Ç—å'], ignore_case=True))
async def farm(message: types.Message):
    """
    –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–æ–º–∞–Ω–¥ —Ñ–∞—Ä–º–∞/—Ñ–µ—Ä–º–∞
    –î–∞–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–∏–Ω–æ–≤ —Ä–∞–∑ –≤ 4 —á–∞—Å–∞
    """
```

**–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—à–µ—Ç `—Ñ–∞—Ä–º–∞`, `—Ñ–µ—Ä–º–∞` –∏–ª–∏ `—Ä–∞–± —Ä–∞–± —Ä–∞–±–æ—Ç–∞—Ç—å`

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —á—ë—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ
2. –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –º–µ—à–∫–∞ (–∏–ª–∏ 0, –µ—Å–ª–∏ –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–∞–±–æ—Ç—ã
4. –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ >= 4 —á–∞—Å–∞: –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–∏–Ω—ã –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞—Ç—É
5. –ï—Å–ª–∏ < 4 —á–∞—Å–æ–≤: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è

**–°–ø–µ—Ü–∏—Ñ–∏–∫–∞:**
- –ö–æ–∏–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ `random.randint(3, 150)`
- –ö—É–ª–¥–∞—É–Ω –∂—ë—Å—Ç–∫–∏–π - —Ä–æ–≤–Ω–æ 4 —á–∞—Å–∞ –º–µ–∂–¥—É —Ä–∞–±–æ—Ç–∞–º–∏
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥—ã (`—Ñ–∞—Ä–º–∞`, `—Ñ–µ—Ä–º–∞`, `—Ä–∞–± —Ä–∞–± —Ä–∞–±–æ—Ç–∞—Ç—å`)

### mesh()

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –±–∞–ª–∞–Ω—Å–∞ –º–µ—à–∫–∞.**

```python
@dp.message_handler(Text(startswith=['–º–µ—à–æ–∫'], ignore_case=True))
async def mesh(message: types.Message):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –º–µ—à–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
```

**–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—à–µ—Ç `–º–µ—à–æ–∫`

**–°–ø–æ—Å–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```
–º–µ—à–æ–∫                    # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤–æ–π –±–∞–ª–∞–Ω—Å
–º–µ—à–æ–∫ @username          # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
[–æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ] –º–µ—à–æ–∫  # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –∞–≤—Ç–æ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
```

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ —Ñ–µ—Ä–º–µ

```python
# –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ message –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async def work_farm(message: types.Message):
    connection = sqlite3.connect(main_path, check_same_thread=False)
    cursor = connection.cursor()
    
    user_id = message.from_user.id
    delta_bust = random.randint(3, 150)
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞
    try:
        meshok_old = cursor.execute(
            "SELECT meshok FROM farma WHERE user_id = ?", 
            (user_id,)
        ).fetchall()[0][0]
    except IndexError:
        meshok_old = 0
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–∏–Ω–æ–≤
    meshok_new = meshok_old + delta_bust
    cursor.execute(
        'UPDATE farma SET meshok = ? WHERE user_id = ?', 
        (meshok_new, user_id)
    )
    cursor.execute(
        'UPDATE farma SET last_date = ? WHERE user_id = ?',
        (datetime.now().strftime("%H:%M:%S %d.%m.%Y"), user_id)
    )
    
    connection.commit()
    await message.answer(f'‚úÖ –ü–æ–ª—É—á–∏–ª {delta_bust} –∫–æ–∏–Ω–æ–≤!')
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ

```python
def get_user_balance(user_id: int, db_path: str) -> int:
    """–ü–æ–ª—É—á–∞–µ—Ç –±–∞–ª–∞–Ω—Å –º–µ—à–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()
    
    try:
        balance = cursor.execute(
            "SELECT meshok FROM farma WHERE user_id = ?", 
            (user_id,)
        ).fetchone()[0]
        return balance
    except (IndexError, TypeError):
        return 0
    finally:
        connection.close()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
balance = get_user_balance(123456, "Base_bot.db")
print(f"–ë–∞–ª–∞–Ω—Å: {balance} eZ¬¢")
```

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–ª–¥–∞—É–Ω–∞

```python
def can_farm_now(user_id: int, db_path: str) -> tuple[bool, str]:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å"""
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()
    
    try:
        last_date_str = cursor.execute(
            "SELECT last_date FROM farma WHERE user_id = ?", 
            (user_id,)
        ).fetchone()[0]
        
        last_date = datetime.strptime(last_date_str, "%H:%M:%S %d.%m.%Y")
        now = datetime.now()
        delta = now - last_date
        
        if delta >= timedelta(hours=4):
            return True, "–ú–æ–∂–µ—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å"
        else:
            remaining = timedelta(hours=4) - delta
            hours = remaining.seconds // 3600
            minutes = (remaining.seconds % 3600) // 60
            return False, f"–ü–æ–¥–æ–∂–¥–∏—Ç–µ {hours}:{minutes:02d}"
    except (IndexError, TypeError):
        # –ü–µ—Ä–≤—ã–π —Ä–∞–∑ —Ä–∞–±–æ—Ç–∞–µ—Ç
        return True, "–ü–µ—Ä–≤–∞—è —Ä–∞–±–æ—Ç–∞"
    finally:
        connection.close()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
can_work, message = can_farm_now(123456, "Base_bot.db")
if can_work:
    print(message)
else:
    print(f"–ù–µ –º–æ–∂–µ—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å: {message}")
```

### –ü—Ä–∏–º–µ—Ä 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–∏–Ω–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ

```python
def add_coins(user_id: int, amount: int, db_path: str) -> bool:
    """–î–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()
    
    try:
        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
        current = cursor.execute(
            "SELECT meshok FROM farma WHERE user_id = ?", 
            (user_id,)
        ).fetchone()
        
        if current is None:
            # –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            cursor.execute(
                "INSERT INTO farma (user_id, meshok, last_date) VALUES (?, ?, ?)",
                (user_id, amount, datetime.now().strftime("%H:%M:%S %d.%m.%Y"))
            )
        else:
            # –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
            new_balance = current[0] + amount
            cursor.execute(
                "UPDATE farma SET meshok = ? WHERE user_id = ?",
                (new_balance, user_id)
            )
        
        connection.commit()
        return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞: {e}")
        return False
    finally:
        connection.close()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
if add_coins(123456, 100, "Base_bot.db"):
    print("‚úÖ –ö–æ–∏–Ω—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã")
else:
    print("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏")
```

### –ü—Ä–∏–º–µ—Ä 5: –í—ã—á–∏—Ç–∞–Ω–∏–µ –∫–æ–∏–Ω–æ–≤ (–¥–ª—è –∏–≥—Ä)

```python
def subtract_coins(user_id: int, amount: int, db_path: str) -> bool:
    """–í—ã—á–∏—Ç–∞–µ—Ç –∫–æ–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è —Å—Ç–∞–≤–æ–∫ –≤ –∏–≥—Ä–∞—Ö)"""
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()
    
    try:
        current = cursor.execute(
            "SELECT meshok FROM farma WHERE user_id = ?", 
            (user_id,)
        ).fetchone()
        
        if current is None or current[0] < amount:
            return False  # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤
        
        new_balance = current[0] - amount
        cursor.execute(
            "UPDATE farma SET meshok = ? WHERE user_id = ?",
            (new_balance, user_id)
        )
        
        connection.commit()
        return True
    except Exception:
        return False
    finally:
        connection.close()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
if subtract_coins(123456, 50, "Base_bot.db"):
    print("‚úÖ –ö–æ–∏–Ω—ã –≤—ã—á—Ç–µ–Ω—ã (—Å—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞)")
else:
    print("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤")
```

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ main_bot.py

```python
# main/main_bot.py

import modules.farm  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

# –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞...

if __name__ == '__main__':
    print("Starting bot...")
    dp.start_polling()
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö

```python
# –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ –º–æ–¥—É–ª–µ kasik.py –¥–ª—è –≤—ã—á–∏—Ç–∞–Ω–∏—è —Å—Ç–∞–≤–∫–∏
from modules.farm import subtract_coins, get_user_balance

async def place_bet(user_id: int, amount: int):
    balance = get_user_balance(user_id, main_path)
    
    if balance < amount:
        return False, "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤"
    
    if subtract_coins(user_id, amount, main_path):
        return True, "–°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞"
    else:
        return False, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Å—Ç–∞–≤–∫–∏"
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
python test_farm.py
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

```
‚úì –¢–µ—Å—Ç 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–∏–Ω–æ–≤ –Ω–æ–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ 100 –∫–æ–∏–Ω–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ

‚úì –¢–µ—Å—Ç 2: –†–∞–±–æ—Ç–∞ –Ω–∞ —Ñ–µ—Ä–º–µ (–ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–∏–Ω–æ–≤)
  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∫–æ–∏–Ω–æ–≤: 45 (–≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 3-150)

‚úì –¢–µ—Å—Ç 3: –ö—É–ª–¥–∞—É–Ω 4 —á–∞—Å–∞
  –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ùå –†–∞–±–æ—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (—Å–ø—É—Å—Ç—è 1 —á–∞—Å)

‚úì –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
  –ë–∞–ª–∞–Ω—Å: 125 –∫–æ–∏–Ω–æ–≤

‚úì –¢–µ—Å—Ç 5: –í—ã—á–∏—Ç–∞–Ω–∏–µ –∫–æ–∏–Ω–æ–≤
  –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ 50 –∫–æ–∏–Ω–æ–≤ –≤—ã—á—Ç–µ–Ω–æ, –±–∞–ª–∞–Ω—Å: 75

–í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!
```

### –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```python
import unittest
import sqlite3
from datetime import datetime, timedelta
from pathlib import Path

class TestFarm(unittest.TestCase):
    def setUp(self):
        """–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∫–∞–∂–¥–æ–º—É —Ç–µ—Å—Ç—É"""
        self.test_db = Path(__file__).parent / 'test_farm.db'
        self.connection = sqlite3.connect(str(self.test_db), check_same_thread=False)
        self.cursor = self.connection.cursor()
        self._create_tables()
    
    def tearDown(self):
        """–û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞"""
        self.connection.close()
        if self.test_db.exists():
            self.test_db.unlink()
    
    def _create_tables(self):
        """–°–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã"""
        self.cursor.execute('''
            CREATE TABLE IF NOT EXISTS farma (
                user_id INTEGER PRIMARY KEY,
                meshok INTEGER DEFAULT 0,
                last_date TEXT
            )
        ''')
        self.connection.commit()
    
    def test_new_user_farm(self):
        """–¢–µ—Å—Ç —Ä–∞–±–æ—Ç—ã –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        user_id = 123456
        self.cursor.execute(
            "INSERT INTO farma (user_id, meshok, last_date) VALUES (?, ?, ?)",
            (user_id, 50, datetime.now().strftime("%H:%M:%S %d.%m.%Y"))
        )
        self.connection.commit()
        
        result = self.cursor.execute(
            "SELECT meshok FROM farma WHERE user_id = ?", 
            (user_id,)
        ).fetchone()
        
        self.assertIsNotNone(result)
        self.assertEqual(result[0], 50)
    
    def test_add_coins(self):
        """–¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–∏–Ω–æ–≤"""
        user_id = 234567
        self.cursor.execute(
            "INSERT INTO farma (user_id, meshok, last_date) VALUES (?, ?, ?)",
            (user_id, 100, datetime.now().strftime("%H:%M:%S %d.%m.%Y"))
        )
        
        # –î–æ–±–∞–≤–ª—è–µ–º 50 –∫–æ–∏–Ω–æ–≤
        current = self.cursor.execute(
            "SELECT meshok FROM farma WHERE user_id = ?", 
            (user_id,)
        ).fetchone()[0]
        
        new_balance = current + 50
        self.cursor.execute(
            "UPDATE farma SET meshok = ? WHERE user_id = ?",
            (new_balance, user_id)
        )
        self.connection.commit()
        
        result = self.cursor.execute(
            "SELECT meshok FROM farma WHERE user_id = ?", 
            (user_id,)
        ).fetchone()[0]
        
        self.assertEqual(result, 150)
    
    def test_cooldown_check(self):
        """–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—É–ª–¥–∞—É–Ω–∞"""
        user_id = 345678
        old_time = datetime.now() - timedelta(hours=2)
        self.cursor.execute(
            "INSERT INTO farma (user_id, meshok, last_date) VALUES (?, ?, ?)",
            (user_id, 50, old_time.strftime("%H:%M:%S %d.%m.%Y"))
        )
        self.connection.commit()
        
        last_date_str = self.cursor.execute(
            "SELECT last_date FROM farma WHERE user_id = ?", 
            (user_id,)
        ).fetchone()[0]
        
        last_date = datetime.strptime(last_date_str, "%H:%M:%S %d.%m.%Y")
        now = datetime.now()
        delta = now - last_date
        
        # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω–µ–µ 4 —á–∞—Å–æ–≤
        self.assertLess(delta, timedelta(hours=4))

if __name__ == '__main__':
    unittest.main()
```

---

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –ò–¥–µ—è 1: –ë–æ–Ω—É—Å—ã –∑–∞ –ø–æ–¥—Ä—è–¥

```python
# –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É
ALTER TABLE farma ADD COLUMN streak INTEGER DEFAULT 0;
ALTER TABLE farma ADD COLUMN last_streak_date TEXT;

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –±–æ–Ω—É—Å–∞
def calculate_streak_bonus(streak: int) -> float:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å –∑–∞ –ø–æ–¥—Ä—è–¥"""
    if streak <= 1:
        return 1.0
    elif streak <= 5:
        return 1.1  # +10%
    elif streak <= 10:
        return 1.2  # +20%
    else:
        return 1.3  # +30%

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
base_coins = 50
streak = 5
bonus = calculate_streak_bonus(streak)
final_coins = int(base_coins * bonus)  # 60 –∫–æ–∏–Ω–æ–≤ –≤–º–µ—Å—Ç–æ 50
```

### –ò–¥–µ—è 2: –†–∞–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Å —Ä–∞–∑–Ω—ã–º –¥–æ—Ö–æ–¥–æ–º

```python
FARM_TASKS = {
    "–ª–µ—Å": {"min": 5, "max": 30, "name": "–†—É–±–∫–∞ –ª–µ—Å–∞"},
    "—Ä—ã–±–∞": {"min": 10, "max": 50, "name": "–†—ã–±–∞–ª–∫–∞"},
    "—Ä—É–¥–∞": {"min": 20, "max": 100, "name": "–î–æ–±—ã—á–∞ —Ä—É–¥—ã"},
    "–æ—Ö–æ—Ç–∞": {"min": 30, "max": 150, "name": "–û—Ö–æ—Ç–∞"}
}

def get_task_reward(task: str) -> int:
    """–ü–æ–ª—É—á–∞–µ—Ç –Ω–∞–≥—Ä–∞–¥—É –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞–¥–∞—á—É"""
    if task not in FARM_TASKS:
        return 0
    task_info = FARM_TASKS[task]
    return random.randint(task_info["min"], task_info["max"])

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
reward = get_task_reward("–æ—Ö–æ—Ç–∞")
print(f"–ó–∞ –æ—Ö–æ—Ç—É –ø–æ–ª—É—á–∏–ª–∏ {reward} –∫–æ–∏–Ω–æ–≤!")
```

### –ò–¥–µ—è 3: –†–µ–π—Ç–∏–Ω–≥ —Ñ–∞—Ä–º–µ—Ä–æ–≤

```python
def get_top_farmers(limit: int = 10, db_path: str = "Base_bot.db") -> list:
    """–ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–ø —Ñ–∞—Ä–º–µ—Ä–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–æ–∏–Ω–æ–≤"""
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()
    
    top = cursor.execute(
        "SELECT user_id, meshok FROM farma ORDER BY meshok DESC LIMIT ?",
        (limit,)
    ).fetchall()
    
    connection.close()
    return top

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
top_farmers = get_top_farmers()
for idx, (user_id, balance) in enumerate(top_farmers, 1):
    print(f"{idx}. User {user_id}: {balance} eZ¬¢")
```

### –ò–¥–µ—è 4: –°–µ–∑–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

```python
SEASONAL_MULTIPLIERS = {
    "spring": 1.2,    # –í–µ—Å–Ω–∞ +20%
    "summer": 1.5,    # –õ–µ—Ç–æ +50%
    "autumn": 1.0,    # –û—Å–µ–Ω—å –æ–±—ã—á–Ω–æ
    "winter": 0.8     # –ó–∏–º–∞ -20%
}

def get_seasonal_multiplier(month: int) -> float:
    """–ü–æ–ª—É—á–∞–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–µ—Å—è—Ü–∞"""
    if month in [3, 4, 5]:  # –ú–∞—Ä—Ç-–º–∞–π
        return SEASONAL_MULTIPLIERS["spring"]
    elif month in [6, 7, 8]:  # –ò—é–Ω—å-–∞–≤–≥—É—Å—Ç
        return SEASONAL_MULTIPLIERS["summer"]
    elif month in [9, 10, 11]:  # –°–µ–Ω—Ç—è–±—Ä—å-–Ω–æ—è–±—Ä—å
        return SEASONAL_MULTIPLIERS["autumn"]
    else:  # –î–µ–∫–∞–±—Ä—å-—Ñ–µ–≤—Ä–∞–ª—å
        return SEASONAL_MULTIPLIERS["winter"]

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
month = datetime.now().month
multiplier = get_seasonal_multiplier(month)
base_reward = 100
final_reward = int(base_reward * multiplier)
```

### –ò–¥–µ—è 5: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞—Ä–º–∞

```python
def get_farm_stats(user_id: int, db_path: str = "Base_bot.db") -> dict:
    """–ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ñ–µ—Ä–º–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    connection = sqlite3.connect(db_path, check_same_thread=False)
    cursor = connection.cursor()
    
    result = cursor.execute(
        "SELECT meshok, last_date FROM farma WHERE user_id = ?",
        (user_id,)
    ).fetchone()
    
    if result is None:
        return {"total_coins": 0, "level": "–ù–æ–≤–∏—á–æ–∫"}
    
    total_coins = result[0]
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–æ–∏–Ω–æ–≤
    if total_coins < 100:
        level = "üü© –ù–æ–≤–∏—á–æ–∫"
    elif total_coins < 500:
        level = "üü© –†–∞–±–æ—Ç—è–≥–∞"
    elif total_coins < 1000:
        level = "üü® –û–ø—ã—Ç–Ω—ã–π —Ñ–µ—Ä–º–µ—Ä"
    elif total_coins < 5000:
        level = "üüß –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª"
    else:
        level = "üü• –õ–µ–≥–µ–Ω–¥–∞ —Ñ–∞—Ä–º—ã"
    
    connection.close()
    
    return {
        "total_coins": total_coins,
        "level": level,
        "last_work": result[1]
    }
```

---

## ‚öôÔ∏è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

- **PRIMARY KEY –Ω–∞ user_id** - –±—ã—Å—Ç—Ä—ã–µ –ø–æ–∏—Å–∫–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - –∑–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π
- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ PRIMARY KEY
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ë–µ–Ω—á–º–∞—Ä–∫–∏

```
Operation              | Quantity | Time (ms)
INSERT INTO farma      | 10,000   | 120
SELECT meshok          | 100,000  | 80
UPDATE meshok          | 10,000   | 100
SELECT top farmers     | 1,000    | 50
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

```python
# ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ
cursor.execute("SELECT meshok FROM farma WHERE user_id = ?", (user_id,))

# ‚ùå –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û
cursor.execute(f"SELECT meshok FROM farma WHERE user_id = {user_id}")
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—ë—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
if user_id in black_list:
    await message.answer("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω")
    return
```

---

## üìö –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **aiogram** 2.25.2+ - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram API
- **sqlite3** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å Python –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **datetime** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "–ö—É–ª–¥–∞—É–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –≤ –ë–î  
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç `"%H:%M:%S %d.%m.%Y"`

```python
datetime.now().strftime("%H:%M:%S %d.%m.%Y")  # –ü—Ä–∞–≤–∏–ª—å–Ω–æ
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ë–∞–ª–∞–Ω—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è"

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–±—ã–ª–∏ –≤—ã–∑–≤–∞—Ç—å `connection.commit()`  
**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ –∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

```python
cursor.execute(...)
connection.commit()  # ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!
```

### –ü—Ä–æ–±–ª–µ–º–∞: "database is locked"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –ë–î –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ  
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `check_same_thread=False`

```python
connection = sqlite3.connect(path, check_same_thread=False)
```

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–ß–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ WERTY | Chat-Manager Bot

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ:** GitHub Copilot  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 20.12.2025
